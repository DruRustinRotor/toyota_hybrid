var ToyotaConsts,tyLoadingSpinnerController;(function(){"use strict";angular.module("Toyota",["Toyota.Directives","Toyota.Factories","Toyota.Services","Toyota.Components","Toyota.Filters","ngTagsInput","ng-directives-utils.transcludeReplace","ngSanitize","angulartics","ngAnimate","directives.viewBox"]);angular.module("Toyota.Directives",[]);angular.module("Toyota.Factories",[]);angular.module("Toyota.Services",[]);angular.module("Toyota.Filters",[]);angular.module("Toyota.Components",[]);angular.module("Toyota").config(["$locationProvider",function(n){n.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})}]).config(["tagsInputConfigProvider",function(n){n.setActiveInterpolation("tagsInput",{placeholder:!0});n.setDefaults("tagsInput",{placeholder:""})}]).config(["$analyticsProvider",function(n){function t(n,t){var i=window.dataLayer||[];t=t||{};t.event=n;i.push(t)}n.virtualPageviews(!1);n.registerEventTrack(t)}]).config(["$qProvider",function(n){n.errorOnUnhandledRejections(!1)}])})();angular.module("Toyota.Factories").factory("Addresses",["$q","$filter","API",function(n,t,i){return function(r){var f=t("formatArgs")(ToyotaConsts.API.Address.AutoComplete.CustomerAddressByAddress,[r]),u=n.defer();return i.get(f).then(function(n){u.resolve(n.data.results)},function(){u.resolve([])}),u.promise}}]);angular.module("Toyota.Factories").factory("Animations",["$q","$filter","API",function(){function i(i){if(i.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),i.is(":hidden")){i.css("height","").css("opacity","").css("pointer-events","auto");return}i.css("transition",t).css("height",n(i).contentHeight+"px").css("margin","").css("padding","");i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i.css("height","").css("opacity","").css("pointer-events","auto")})}function r(i){if(i.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),i.css("pointer-events","none"),i.css("opacity")==="0"){i.css("height","0").css("margin","0").css("padding","0");return}i.css("transition",t).css("height",n(i).visibleHeight+"px").css("opacity","0");i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i.css("height","0").css("margin","0").css("padding","0")})}function u(n){n.css("height","0").css("opacity","0").css("pointer-events","none")}function f(n){n.css("height","").css("opacity","").css("pointer-events","")}function n(n){var t=n.children().filter(function(n,t){return $(t).css("display")!=="none"}),i=t.map(function(n,t){return t.getBoundingClientRect().top}).toArray(),r=t.map(function(n,t){return t.getBoundingClientRect().bottom}).toArray(),u=Math.min.apply(null,i),f=Math.max.apply(null,r);return{visibleHeight:n.height(),contentHeight:f-u}}var t="height .8s cubic-bezier(.4,.4,.2,1), margin .8s cubic-bezier(.4,.4,.2,1), padding .8s cubic-bezier(.4,.4,.2,1), opacity .4s ease-in-out";return{slideThenFadeIn:i,fadeThenSlideOut:r,hide:u,show:f}}]);angular.module("Toyota.Factories").factory("API",["$http","$q",function(n,t){return{get:function(i){var r=t.defer();return n({method:"GET",url:i,timeout:r.promise}).then(function(n){n.ErrorMessage?r.reject(n,200):r.resolve(n)},function(n){var t={reason:n.data,status:n.status,ErrorMessage:n.status.toString()};r.reject(t)}),r.promise._httpTimeout=r,r.promise.cancel=function(){r.resolve()},r.promise},post:function(i,r){var u=t.defer();return n({method:"POST",url:i,data:r}).then(function(n){n.ErrorMessage?u.reject(n,200):u.resolve(n)},function(n){var t={reason:n.data,status:n.status,ErrorMessage:n.status.toString()};u.reject(t)}),u.promise},cancel:function(n){return n&&n._httpTimeout&&n._httpTimeout.resolve&&n._httpTimeout.resolve(),n}}}]);angular.module("Toyota.Factories").factory("CssMediaWatcher",["$interval",function(){function t(n,t){if(!n.length)throw new Error("No elements passed in jQuery object");var i=window.getComputedStyle(n.get(0),t).getPropertyValue("content"),r=/"(.*?)"/;return r.test(i)?i.match(r)[1]:i}function n(n,i,r){var s=t(n,"::"+i),e=null,o={},u,f;for(u in r)r.hasOwnProperty(u)&&(f=new RegExp(r[u]).test(s),o[u]=f,f&&(e=u));return{viewportWidth:{breakpoint:e,is:o}}}return function(t){function s(){r=n(i.$el,i.pseudoEl,i.breakpointRegexes);JSON.stringify(f)!==JSON.stringify(r)&&(i.$eventGenerator.trigger("didInitOrChange",r),i.$eventGenerator.trigger("didChange",r),f=r)}var u={},r,f,e,i,o=u.getCurrentMedia=function(){if(!i.$el)throw new Error("$el is undefined");return n(i.$el,i.pseudoEl,i.breakpointRegexes)};if(u.off=function(){return i.$eventGenerator.off.apply(i.$eventGenerator,arguments),u},u.on=function(n,t){return i.$eventGenerator.on.apply(i.$eventGenerator,arguments),e&&(n==="didInit"||n==="didInitOrChange")&&t(new $.Event(n),o()),u},typeof t=="undefined"&&(t={}),e=!1,i={$el:$("body"),pseudoEl:"before",$eventGenerator:$(u),breakpointRegexes:{xxxs:"^xxxs$",xxs:"^xxs$",xs:"^xs$",sm:"^sm$",md:"^md$",lg:"^lg$"}},$.extend(i,t),!i.$el.length)throw new Error("No $el found. Did you specify one?");return i.$eventGenerator.trigger("willInit"),r=o(),f=r,window.setInterval(s,Math.floor(1e3/60)),i.$eventGenerator.trigger("didInitOrChange",r),i.$eventGenerator.trigger("didInit",r),e=!0,u}}]);angular.module("Toyota.Factories").factory("DealerInventoryService",["$q","$filter","API",function(n,t,i){return{get:function(n,r){var u=t("formatArgs")(ToyotaConsts.API.Vehicle.DealerStock,[n,r]);return i.get(u)},cancel:i.cancel}}]);angular.module("Toyota.Factories").factory("Dealer",["$rootScope","localstorage",function(n,t){function f(n){i.address=n.address;i.branchCode=n.branchCode;i.city=n.city;i.dealerCode=n.dealerCode;i.email=n.email;i.name=n.name;i.postCode=n.postCode;i.region=n.region;i.state=n.state;i.telephone=n.telephone;t.set(u,{address:n.address,branchCode:n.branchCode,city:n.city,dealerCode:n.dealerCode,email:n.email,name:n.name,postCode:n.postCode,region:n.region,state:n.state,telephone:n.telephone});o()}function e(){return t.isExists(u)?t.get(u):{address:"",branchCode:"",city:"",dealerCode:"",email:"",name:"",postCode:"",region:"",state:"",telephone:""}}function r(){return i.name!=""?i:(i=e(),delete i.expiry,i)}function o(){n.$broadcast("DealerChange",i)}var u="dealer_information",i={address:"",branchCode:"",city:"",dealerCode:"",email:"",name:"",postCode:"",region:"",state:"",telephone:""};return i.address=r().address,i.branchCode=r().branchCode,i.city=r().city,i.dealerCode=r().dealerCode,i.email=r().email,i.name=r().name,i.postCode=r().postCode,i.region=r().region,i.state=r().state,i.telephone=r().telephone,{update:f,get:r}}]);angular.module("Toyota.Factories").factory("Geodecode",["$q","$filter","API","Geolocation",function(n,t,i,r){return function(){var f=n.defer(),u={isSuccessfull:!1,data:{},message:""},e={},o=function(n){if(n&&n.success){var r=t("formatArgs")(ToyotaConsts.API.Address.GeoDecode,[n.lat,n.lng]);i.get(r).then(function(n){$.each(n.data.results,function(n,t){t.types[0]==="postal_code"&&(e.postcode=t.address_components[0].short_name);t.types[0]==="locality"&&(e.suburb=t.address_components[0].short_name);t.types[0]==="administrative_area_level_1"&&(e.state=t.address_components[0].short_name)});u.isSuccessfull=!0;u.data=e;f.resolve(u)},function(){u.message="failed to get the parsed address";f.reject(u)})}else u.message="failed to get the co-ordinates from geolocation service",f.reject(u)},s=function(n){u.message=n?n.message:"geo service unavailable";f.reject(u)},h=r();return h.then(o,s),f.promise}}]);angular.module("Toyota.Factories").factory("Geolocation",["$q","$rootScope",function(n,t){return function(){var i=n.defer(),o="geolocation"in navigator,r,f={timeout:8e3},e,u;return o?(e=function(n){n&&(window.clearTimeout(r),i.resolve({lat:n.coords.latitude,lng:n.coords.longitude,success:!0,message:"pass"}))},u=function(n){window.clearTimeout(r);i.reject({success:!1,error:n,message:n},200)},r=window.setTimeout(u,f.timeout),navigator.geolocation.getCurrentPosition(e,u,f),t.$on("modal-open",function(){window.clearTimeout(r)})):i.reject({success:!1,message:"geoLocation is not supported"}),i.promise}}]);angular.module("Toyota.Factories").factory("InfoService",["$q","$filter",function(){var n={};return{registerInfo:function(t,i){n[t]=i},get:function(t){return n[t]}}}]);angular.module("Toyota.Factories").factory("localstorage",["$window",function(n){function t(){var n="lctest";try{return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(t){return!1}}return{set:function(i,r,u){if(t()){var f=null,e=null;angular.isNumber(u)&&(f=Date.now()+6e4*u);e=typeof r=="object"?angular.extend({expiry:f},r):{val:r,expiry:f};n.localStorage.setItem(i,JSON.stringify(e))}},get:function(i){var r,u;return t()?(r=n.localStorage.getItem(i),r?(r=JSON.parse(r),r.expire?(u=Date.now(),r.expire<u)?(n.localStorage.removeItem(i),null):r.val:r):null):null},isExists:function(i){return t()?n.localStorage.getItem(i)!=null?!0:!1:!1},remove:function(i){if(t()){var r=n.localStorage.getItem(i);return r?(n.localStorage.removeItem(i),!0):!1}}}}]);angular.module("Toyota.Factories").factory("Location",["$rootScope","localstorage",function(n,t){function f(n,r,f,e){i.postcode=n;i.suburb=r;i.state=f;i.region=e;t.set(u,{postcode:n,suburb:r,state:f,region:e});o()}function e(){return t.isExists(u)?t.get(u):{postcode:"",suburb:"",state:"",region:""}}function r(){return i.postcode!=""?i:(i=e(),delete i.expiry,i)}function o(){n.$broadcast("GeoPostCode",i.postcode,i.suburb,i.state,i.region)}var u="location_service_information",i={postcode:"",suburb:"",state:"",region:""};return i.postcode=r().postcode,i.suburb=r().suburb,i.state=r().state,i.region=r().region,{update:f,get:r}}]);angular.module("Toyota.Factories").factory("PaintListColourMatcher",[function(){function u(n){var t=[];return angular.forEach(n,function(n){t.push({description:n.description,hex:i(n.hex).toCSSHex(),colour:i(n.hex)})}),t}function n(n){var i=n.red/255,r=n.green/255,u=n.blue/255,f,t,e;return i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,u=u>.04045?Math.pow((u+.055)/1.055,2.4):u/12.92,f=(i*.4124+r*.3576+u*.1805)/.95047,t=(i*.2126+r*.7152+u*.0722)/1,e=(i*.0193+r*.1192+u*.9505)/1.08883,f=f>.008856?Math.pow(f,1/3):7.787*f+16/116,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,{l:116*t-16,a:500*(f-t),b:200*(t-e)}}function r(n,t){var l=n.l-t.l,f=n.a-t.a,e=n.b-t.b,r=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(t.a*t.a+t.b*t.b),u=r-a,i=f*f+e*e-u*u;i=i<0?0:Math.sqrt(i);var v=1+.045*r,y=1+.015*r,o=l/1,s=u/v,h=i/y,c=o*o+s*s+h*h;return c<0?0:Math.sqrt(c)}function t(n){var t=n.toHSV(),i,r;return t.saturation=1-(1-t.saturation)*(1-t.saturation),i=n.getLuminance(),r=i*i*i,t.saturation=t.saturation*(1-r),t.toRGB()}var i=window.Color||net.brehaut.Color;return function(f){var e={},s=[],o={colourTuples:[],normalizedColourTuples:[]};return angular.extend(o,f),o.normalizedColourTuples=s=u(o.colourTuples),e.getColourTuples=function(){return angular.copy(o.normalizedColourTuples)},e.exactMatch=function(n){n=angular.extend({},n);n.colour=new i(n.hex);for(var t=0,r;t<s.length;t++)if(r=s[t],n.description===r.description&&n.colour.toCSSHex()===r.colour.toCSSHex())return!0;return!1},e.closestMatch=function(u,f){var o=i(u.hex),s=e.getColourTuples().sort(function(i,f){var e=r(n(t(i.colour)),n(t(o))),s=r(n(t(f.colour)),n(t(o))),h=i.description===u.description?0:1,c=f.description===u.description?0:1;return(e-s)*.999999+(h-c)*1e-6}),h=1-r(n(s[0].colour),n(o));return typeof f=="number"&&h<f?null:angular.extend({percentMatch:h},s[0])},e}}]);angular.module("Toyota.Factories").factory("Postcodes",["$q","$filter","API",function(n,t,i){return function(r,u){var e=t("formatArgs")(ToyotaConsts.API.Address.AutoComplete.DealerAddressBySuburbPostcode,[r,u]),f=n.defer();return i.get(e).then(function(n){var t=[],i=0;_.each(n.data.results,function(n){t.push({text:n.suburb+", "+n.postCode+" "+n.state,id:i++,tagInfo:angular.extend({},n)})});f.resolve(t)},function(){f.resolve([])}),f.promise}}]);angular.module("Toyota.Factories").factory("PriceService",["$q","$filter","API","Location","$timeout",function(n,t,i,r,u){function c(){u.cancel(h);h=u(function(){l()},p)}function l(){var n=a(f),t=f;f=[];n.forEach(function(n){i.get(n).then(function(n){n.data&&n.data.driveawayPriceList&&n.data.driveawayPriceList.forEach(function(t){var i=o(t.materialCode,t.accessoriesPrice,n.data.postcode);i!=null&&i.deferred.resolve({materialCode:t.materialCode,accessoriesPrice:t.accessoriesPrice,postcode:n.data.postcode,driveawayPrice:t.price,driveawayPriceDisclaimer:t.driveawayPriceDisclaimer,isDriveawayPriceOverridden:t.isDriveawayPriceOverridden,financeOptions:t.financeOptions})})},function(){t.forEach(function(n){n.deferred.reject(n)})})})}function o(n,i,r){return t("arrayFind")(s,function(t){return t.materialCode===n&&t.accessoriesPrice===i&&t.postcode===r})}function a(n){for(var f=[],o=r.get().postcode,i=n.map(function(n){return n.materialCode+y+n.accessoriesPrice}),u=0;u<i.length;u+=e){var s=i.length<e?i.length:e,h=i.slice(u,u+s),c=h.join(v),l=t("formatArgs")(ToyotaConsts.API.Vehicle.PricingInfoBatch,[c,o]);f.push(l)}return f}var s=[],f=[],h,v="|",y=",",e=5,p=200,w={get:function(i,r,u){var e,h,l;return(i=i.toString(),r=t("twoDecimalPlacesString")(r),u=u.toString(),e=o(i,r,u),e!=null)?e.deferred.promise:(h=n.defer(),l={materialCode:i,accessoriesPrice:r,postcode:u,deferred:h},c(),s.push(l),f.push(l),h.promise)}};return{pricingInfoBatch:w}}]);angular.module("Toyota.Factories").factory("Region",["$q","$filter","API",function(n,t,i){return function(r,u){var e=t("formatArgs")(ToyotaConsts.API.Info.Dealers,[r,u]),f=n.defer();return i.get(e).then(function(n){!!n.data&&n.data.results.length>0?f.resolve(n.data.results[0].region):f.resolve("")},function(){f.resolve("")}),f.promise}}]);angular.module("Toyota.Factories").factory("Accessories",["$q","$filter","API",function(n,t,i){function u(n,i,u){return t("arrayFind")(r.accessories,function(t){return t.accessoryCode===n&&t.materialCode===i&&t.postcode===u})}function f(f,e,o){var s=n.defer(),h=u(f,e,o);return typeof h!="undefined"?s.resolve(h):i.get(t("formatArgs")(ToyotaConsts.API.Accessories.Accessory,[f,e,o])).then(function(n){if(n.data.success){var t={accessoryCode:f,materialCode:e,postcode:o,data:n.data};r.accessories.push(t);s.resolve(t)}else s.reject(n)},function(n){s.reject(n)}),s.promise}var r={accessories:[]};return{getAccessory:f}}]);angular.module("Toyota.Factories").factory("RangePaint",["$q","$filter","API",function(n,t,i){function r(n){return i.get(t("formatArgs")(ToyotaConsts.API.Vehicle.PaintByMaterialCode,[n])).then(function(n){return n.data.paint})}return{getByMaterialCode:r}}]);angular.module("Toyota.Factories").factory("Range",["$q","$filter","RangeVariant","RangeTrim","RangePaint",function(n,t,i,r,u){function e(t,i,r,u){if(typeof f.range[i][t]!="undefined"&&typeof f.mapping[i][t]!="undefined"){var e=n.defer();return e.resolve(f.range[i][t]),e.promise}return u.getById(t).then(function(n){return n.success&&(f.range[i][t]=n[i],f.mapping[i][t]=[],typeof n[r+"s"]!="undefined"&&angular.forEach(n[r+"s"],function(n){f.range[r][n.ID]=n;f.mapping[i][t].push(n.ID)})),f.range[i][t]})}function o(n,t){return n.map(function(n){return f.range[t][n]})}function s(t,i,r,u){if(typeof f.mapping[r][t]!="undefined"){var s=n.defer();return s.resolve(o(f.mapping[r][t],i)),s.promise}return e(t,r,i,u).then(function(){return o(f.mapping[r][t],i)})}function l(n){f.variantOptions=n}function a(n){f.gradesList=n}function v(n){return h(n).variants}function h(n){return t("arrayFind")(f.gradesList,function(t){return t.gradeId===n})}function c(n,t){for(var u,r=Object.keys(f.mapping[t]),i=0;i<r.length;i++)if(u=f.mapping[t][r[i]].find(function(t){return n===t}),u)return r[i]}var f={range:{variant:{},trim:{},paint:{}},mapping:{variant:{},trim:{}},variantOptions:{},gradesList:{}};return{getVariantById:function(n){return e(n,"variant","trim",i)},getTrimById:function(n){return e(n,"trim","paint",r)},getPaintById:function(n){return e(n,"paint","",u)},getTrimsByVariantId:function(n){return s(n,"trim","variant",i)},getPaintsByTrimId:function(n){return s(n,"paint","trim",r)},getVariantsByGradeId:v,getGradeById:h,getVariantIdByTrimId:function(n){return c(n,"variant")},getTrimIdByPaintId:function(n){return c(n,"trim")},setVariantOptions:l,getVariantOptions:function(){return f.variantOptions},setGradesList:a,getGradesList:function(){return f.gradesList}}}]);angular.module("Toyota.Factories").factory("RangeTrim",["$q","$filter","API",function(n,t,i){function r(n){return i.get(t("formatArgs")(ToyotaConsts.API.Vehicle.Trims,[n])).then(function(n){return n.data})}return{getById:r}}]);angular.module("Toyota.Factories").factory("RangeVariant",["$q","$filter","API",function(n,t,i){function r(n){return i.get(t("formatArgs")(ToyotaConsts.API.Vehicle.Variants,[n])).then(function(n){return n.data})}return{getById:r}}]);angular.module("Toyota.Services").service("ToastManager",["$window",function(){var n=this,t=null,i={$el:$(".js-toast-container")};return n.registerController=function(n){t=n},n.triggerBriefToast=function(n,i){return t.addToast(n,6e3,i)},n.triggerForeverToast=function(n,i){return t.addToast(n,null,i)},n.removeToast=function(n){t.removeToast(n)},n.removeToastsByGroup=function(n){t.removeToastsByGroup(n)},n}]);angular.module("Toyota.Services").service("MouseDetectionService",["$rootScope",function(n){var i=this,t=function(){return this.resetMouseFoundAndBuffer(),this.startWatching(),this};return t.prototype.timestampMsArrayLooksLikeMouseData=function(n,t,i){var f=n.length===t,e=t/i*1e3,r,u;return f&&(r=n[0],u=n[n.length-1],e>=u-r)?!0:!1},t.prototype.resetMouseFoundAndBuffer=function(){this.mouseMoveTimestampMsBuffer=[];this.mouseFound=!1;n.$broadcast("did-lose-mouse")},t.prototype.tellMouseFound=function(){this.mouseFound=!0;n.$broadcast("did-detect-mouse")},t.prototype.stopWatching=function(){$("body").off("mousemove.MouseDetectionAgent")},t.prototype.startWatching=function(){var n=this,t=10;$("body").on("mousemove.MouseDetectionAgent",function(){n.mouseMoveTimestampMsBuffer.length>=t&&n.mouseMoveTimestampMsBuffer.shift();n.mouseMoveTimestampMsBuffer.push((new Date).valueOf());n.timestampMsArrayLooksLikeMouseData(n.mouseMoveTimestampMsBuffer,t,10)&&(n.tellMouseFound(),n.stopWatching())})},new t}]);angular.module("Toyota.Services").service("GlobalBreakpoints",["$filter",function(n){var t=this,i=["xxxs","xxs","xs","sm","md","lg"];return t.parseExpressionToArray=function(n){return n==="all"?t.all():n.match(/^.*-$/)?t.prevAllAndSelf(n.match(/^(.*)-$/)[1]):n.match(/^.*\+$/)?t.nextAllAndSelf(n.match(/^(.*)\+$/)[1]):[n]},t.parseCompoundExpression=function(r){return r?n("arrayUnique")(r.split(" ").map(function(n){return t.parseExpressionToArray(n)}).reduce(function(n,t){return n.concat(t)},[]).sort(function(n,t){return i.indexOf(n)-i.indexOf(t)})):null},t.prev=function(n){var t=i.indexOf(n);return t===-1||t===0?null:i[t-1]},t.next=function(n){var t=i.indexOf(n);return t===-1||t===i.length-1?null:i[t+1]},t.prevAllAndSelf=function(n){var t=i.indexOf(n);return t===-1?[]:i.slice(0,t+1)},t.nextAllAndSelf=function(n){var t=i.indexOf(n);return t===-1?[]:i.slice(t)},t.all=function(){return i.slice(0)},t}]);angular.module("Toyota.Services").service("ScrollLock",["$window",function(){function f(n){n.preventDefault()}function s(){if(e)$(window).on("scroll",function(){var i=document.body.clientHeight,n=t.get(0).getBoundingClientRect(),u=n.bottom-n.top;r.html(["document.body.clientHeight: "+i,"viewportHeight: "+u].join("<br />"))});i&&window.addEventListener("touchmove",function(){})}var n=this,e=!1,i=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,o=null,t=$('<div data-viewport-size style="position: fixed; z-index: 9999; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;"><\/div>'),r,u;return $("body").append(t),e&&(r=$('<div style="background: rgba(255,255,255,.9);"><\/div>'),t.append(r)),u={},n.lock=function(r){var v=$("html, body"),l=$("html"),a=$("body"),s=$(window).scrollTop(),h=t.get(0).getBoundingClientRect(),c=h.bottom-h.top,e={preventElasticScrollingInIos:!0,allowInnerScrollingInIos:!1};if(e.preventElasticScrollingInIos&&e.allowInnerScrollingInIos)throw new Error("There is no known way to prevent elastic scrolling in iOS while also allowing scrolling within elements inside the document. If you find a way, please implement it and remove this message.");$.extend(e,r);i&&!e.allowInnerScrollingInIos?document.addEventListener("touchmove",f,{passive:!1}):(l.css({height:c}),a.css({position:"fixed",overflow:"hidden",top:-s,height:c+s+"px"}),$(window).scrollTop(0));n.isLocked=!0;o=s;u=angular.copy(e)},n.unlock=function(){var e=$("html, body"),t=$("html"),r=$("body");i&&!u.allowInnerScrollingInIos?document.removeEventListener("touchmove",f):(t.css({height:""}),r.css({position:"",overflow:"",top:"",height:""}),$(window).scrollTop(o));n.isLocked=!1},s(),n}]);angular.module("Toyota.Filters",[]).filter("formatArgs",[function(){return function(n,t){return angular.forEach(t,function(t,i){n=n.replace("{"+i+"}",t)}),n}}]).filter("formatPrice",["$filter",function(n){return function(t){return n("currency")(Math.ceil(t),"$",0)}}]).filter("formatSuper",[function(){return function(n){return angular.isString(n)?n.replace(/(\[.*?\])/g,"<sup>$1<\/sup>"):""}}]).filter("removeSpaces",function(){return function(n){return angular.isString(n)?n.replace(/[\s]/g,""):n}}).filter("arrayFind",function(){return function(n,t,i){for(var r=0;r<n.length;r++)if(t.call(i,n[r],r,n))return n[r];return undefined}}).filter("twoDecimalPlacesString",function(){return function(n){return(Math.round(parseFloat(n)*100)/100).toString()}}).filter("arrayIntersect",function(){return function(n,t){if(!(n instanceof Array&&t instanceof Array))throw new Error("Both arguments must be an Array");return n.filter(function(n){return t.indexOf(n)>-1}).filter(function(n,t,i){return i.indexOf(n)===t})}}).filter("arraySubtract",function(){return function(n,t){if(!(n instanceof Array&&t instanceof Array))throw new Error("Both arguments must be an Array");return n.filter(function(n){return t.indexOf(n)===-1})}}).filter("arrayUnique",function(){return function(n){return n.filter(function(n,t,i){return t==i.indexOf(n)})}});ToyotaConsts={API:{Address:{AutoComplete:{DealerAddressBySuburbPostcode:"/main/api/v1/toyotaforms/address/dealeraddress/{0}?maxresults={1}",CustomerAddressByAddress:"/main/api/v1/toyotaforms/address/autocomplete/{0}"},ById:"/main/api/v1/toyotaforms/address/addressbyid/{0}",GeoDecode:"/main/api/v1/toyotaforms/address/addressgeodecode/{0}/{1}"},Info:{Dealers:"/main/api/v1/toyotaforms/info/dealers/{0}/{1}",DealersByServiceType:"/main/api/v1/toyotaforms/info/dealers/{0}/{1}?servicetype={2}",AllDealers:"/main/api/v1/toyotaforms/info/dealers/all",DealersByState:"/main/api/v1/toyotaforms/info/dealersbystate/{0}"},Validation:{Phone:"/main/api/v1/toyotaforms/validate/phone?number={0}",Email:"/main/api/v1/toyotaforms/validate/email?email={0}",Postcode:"/main/api/v1/toyotaforms/validate/postcode/{0}"},Vehicle:{DriveAwayPrice:"/main/api/v1/toyotavehicles/pricing/driveaway/price/{0}/{1}/{2}",FinancingOptions:"/main/api/v1/toyotascope/financingoptions/{0}",DealerStock:"/main/api/v1/toyotavehicles/inventory/dealerUrl/{0}/{1}",PricingInfo:"/main/api/v1/toyotavehicles/pricing/info/{0}/{1}/{2}",PricingInfoBatch:"/main/api/v1/toyotavehicles/pricing/info?materialCodeObj={0}&postcode={1}",Image:"/main/api/v1/toyotavehicles/image/all/{0}",BaseMaterialCodeByVariantId:"/main/api/v1/toyotavehicles/mdmVehicleData/material-codes/variant/{0}",Grade:"/main/api/v1/toyotavehicles/range/grades/{0}",Variants:"/main/api/v1/toyotavehicles/range/grades/variants/{0}",Trims:"/main/api/v1/toyotavehicles/range/grades/variants/trims/{0}",PaintByMaterialCode:"/main/api/v1/toyotavehicles/range/paint?materialCode={0}"},Accessories:{Accessory:"/main/api/v1/toyotavehicles/accessories/accessory/{0}?materialCode={1}&postcode={2}"},News:{PressListings:"/main/api/v1/news/toyota/listings?pageNumber={pageNumber}&category={category}&siteID={siteId}&pageLookUp={currentPage}"}},InfoKeys:{SecondaryNavMetrics:"nav-header-metrics"}};tyLoadingSpinnerController=["$scope","$element",function(n,t){var i=this;i.$onInit=function(){var r=t.children("svg").first(),n={small:"24px",medium:"36px",large:"52px"};for(var i in n)if(n.hasOwnProperty(i)&&typeof t.attr(i)!="undefined"){r.attr("width",n[i]);r.attr("height",n[i]);break}}}];angular.module("Toyota.Components").component("tyLoadingSpinner",{templateUrl:"/Assets/Toyota/MainSite/html/icons/loadingspinner.html",controller:tyLoadingSpinnerController});angular.module("Toyota.Directives").directive("tyBrightcovePlugin",function(){return{scope:{pluginName:"@tyBrightcovePluginName",pluginConfig:"&tyBrightcovePluginConfig"},link:function(n,t){var r=t.find("video").attr("id").replace(/_[a-z0-9]+_api/i,""),i=n.pluginConfig(),u;i.container&&(i.container=$(i.container).get(0));console.log('About to run Brightcove plugin "'+n.pluginName+'" on #'+r+" with config",i);u=videojs(r);u[n.pluginName](i)}}});angular.module("Toyota.Directives").directive("tyCementAttribute",function(){var n=/android/i.test(navigator.userAgent),t=/iPad|iPhone|iPod/i.test(navigator.userAgent),i=/Chrome|CriOS/i.test(navigator.userAgent);return{scope:{attribute:"@tyCementAttributeWhich"},link:function(r,u){var f,e;if(i&&(n||t)){f=r.attribute?r.attribute:"height";u.css(f,u.css(f));e=gajus.orientationchangeend({});e.on("orientationchangeend",function(){u.css(f,"");u.css(f,u.css(f))})}}}});angular.module("Toyota.Directives").directive("tyDealerInventory",["$filter","$rootScope","$analytics","API","Location","Dealer","DealerInventoryService",function(n,t,i,r,u,f,e){var o=["$scope",function(n){var i=this,r=null;n.dealerInventory=n.dealerInventory?n.dealerInventory:{};n.dealerInventory.loading=!1;i.init=function(){n.$on("GeoPostCode",function(t,r){n.dealerInventory.hasLocation=r!="";i.updatePrompt();i.fetchUrl()});n.$on("DealerChange",function(t,r){n.dealerInventory.hasDealer=r.branchCode!="";i.updatePrompt();i.fetchUrl()});n.$watch("materialCode",function(){i.updatePrompt();i.fetchUrl()})};i.init();i.fetchUrl=function(){i.hasAllData()&&(n.dealerInventory.loading=!0,n.dealerInventory.error=!1,e.cancel(r),r=e.get(f.get().branchCode,n.materialCode),r.then(function(t){if(t&&t.data){var i=t.data;i.success?n.dealerInventory.url=i.url:n.dealerInventory.error=!0}n.dealerInventory.loading=!1},function(){n.dealerInventory.loading=!1}))};i.hasAllData=function(){return n.dealerInventory.hasLocation&&n.dealerInventory.hasDealer&&!!n.materialCode};i.checkLocalStock=function(r){i.hasAllData()||(r.preventDefault(),i.showChangeLocationModal(),t.$broadcast("check-local-stock",n.materialCode));n.dealerInventory.error&&r.preventDefault()};i.showChangeLocationModal=function(){t.$broadcast("modal-open","change-location")};i.updatePrompt=function(){if(!n.dealerInventory.hasLocation){n.dealerInventory.promptMessage=n.dealerInventory.locationMissingPrompt;return}if(!n.dealerInventory.hasDealer){n.dealerInventory.promptMessage=n.dealerInventory.dealerMissingPrompt;return}n.dealerInventory.promptMessage=""}}];return{scope:!1,restrict:"A",controller:o,bindToController:!0,controllerAs:"dealerInventoryController",link:function(n,t,i){n.dealerInventory={hasLocation:u.get().postcode!="",hasDealer:f.get().branchCode!="",locationMissingPrompt:i.missingLocationPrompt,dealerMissingPrompt:i.missingDealerPrompt,eventCategory:i.eventCategory,promptMessage:"",error:!1,url:""};n.dealerInventoryController.updatePrompt();n.dealerInventoryController.fetchUrl()}}}]);angular.module("Toyota.Directives").directive("tyDriveawayPrice",function(){var n=["$scope","$filter","$q","API","Location","PriceService","Accessories","$timeout",function(n,t,i,r,u,f,e){function s(){n.$on("GeoPostCode",function(){n.fetchLocation();n.fetchPrice()});n.$watchGroup(["driveawayPrice.materialCode","driveawayPrice.accessoriesPrice","driveawayPrice.accessoryCodes"],function(){n.fetchPrice()});n.$watch("driveawayPrice.hidePrice",function(){n.fetchPrice()});n.fetchLocation();n.fetchPrice()}function o(i){f.pricingInfoBatch.get(n.driveawayPrice.materialCode,i||0,n.driveawayPrice.postcode).then(function(r){if(r.materialCode===n.driveawayPrice.materialCode&&r.accessoriesPrice===t("twoDecimalPlacesString")(i||0)&&r.postcode===n.driveawayPrice.postcode.toString()){if(n.driveawayPrice.loading=!1,!r.driveawayPrice){n.driveawayPrice.dataError=!0;return}n.driveawayPrice.price=r.driveawayPrice;n.driveawayPrice.disclaimerOverride=r.isDriveawayPriceOverridden?r.driveawayPriceDisclaimer:"";n.fetchFinancingOptions(r.financeOptions)}},function(r){r.materialCode===n.driveawayPrice.materialCode&&r.accessoriesPrice===t("twoDecimalPlacesString")(i||0)&&r.postcode===n.driveawayPrice.postcode.toString()&&(n.driveawayPrice.loading=!1,n.driveawayPrice.serverError=!0)})}function h(){return n.driveawayPrice.materialCode?!n.driveawayPrice.hidePrice:!1}function c(){return!!n.driveawayPrice.postcode}var l=this;n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{};n.driveawayPrice.price=0;n.driveawayPrice.disclaimerOverride="";n.driveawayPrice.loading=!1;n.driveawayPrice.serverError=!1;n.driveawayPrice.dataError=!1;n.driveawayPrice.hidePrice=!1;n.driveawayPrice.locationError=!1;n.driveawayPrice.financeInfoAvailable=!0;n.financingOptions=n.financingOptions?n.financingOptions:{};n.financingOptions.priceWeek="";n.financingOptions.priceWeekText="";n.financingOptions.compRate="";n.financingOptions.compRateText="";n.financingOptions.loanTerm="";n.financingOptions.loanTermText="";n.financingOptions.leftText="";n.financingOptions.leftLink="";n.financingOptions.midText="";n.financingOptions.midLink="";n.financingOptions.rightText="";n.financingOptions.rightLink="";n.fetchPrice=function(){if(h())n.driveawayPrice.dataError=!1;else{n.driveawayPrice.dataError=!0;return}if(c())n.driveawayPrice.locationError=!1;else{n.driveawayPrice.locationError=!0;return}n.driveawayPrice.loading=!0;n.driveawayPrice.serverError=!1;var t=0;Array.isArray(n.driveawayPrice.accessoryCodes)&&n.driveawayPrice.accessoryCodes.length>0?i.all(n.driveawayPrice.accessoryCodes.map(function(i){return e.getAccessory(i,n.driveawayPrice.materialCode,n.driveawayPrice.postcode).then(function(n){t+=n.data.price})})).then(function(){o(t)},function(){n.driveawayPrice.loading=!1;n.driveawayPrice.serverError=!0}):o(n.driveawayPrice.accessoriesPrice)};n.fetchLocation=function(){var t=u.get();n.driveawayPrice.postcode=t.postcode;n.driveawayPrice.suburb=t.suburb;n.driveawayPrice.state=t.state;n.driveawayPrice.locationString=t.suburb+", "+t.state+" "+t.postcode};n.resetFinancingOptions=function(){n.financingOptions.priceWeek="";n.financingOptions.priceWeekText="";n.financingOptions.compRate="";n.financingOptions.compRateText="";n.financingOptions.loanTerm="";n.financingOptions.loanTermText="";n.financingOptions.leftText="";n.financingOptions.leftLink="";n.financingOptions.midText="";n.financingOptions.midLink="";n.financingOptions.rightText="";n.financingOptions.rightLink=""};n.fetchFinancingOptions=function(t){if(n.resetFinancingOptions(),t){if(!t.leftText1||!t.midText1||!t.rightText1||!t.leftText||!t.midText||!t.rightText)return;t.isActive&&(n.financingOptions.priceWeek=t.leftText1,n.financingOptions.priceWeekText=t.leftText2,n.financingOptions.compRate=t.midText1,n.financingOptions.compRateText=t.midText2,n.financingOptions.loanTerm=t.rightText1,n.financingOptions.loanTermText=t.rightText2,n.financingOptions.leftText=t.leftText,n.financingOptions.leftLink=t.leftTextLink,n.financingOptions.midText=t.midText,n.financingOptions.midLink=t.midTextLink,n.financingOptions.rightText=t.rightText,n.financingOptions.rightLink=t.rightTextLink)}};n.driveawayPrice.showPrice=function(){return n.driveawayPrice.loading||n.driveawayPrice.locationError||n.driveawayPrice.serverError||n.driveawayPrice.dataError?!1:n.driveawayPrice.price===0||n.driveawayPrice.price==="0"?!1:!0};this.$onInit=s}],t=function(){};return{scope:!1,restrict:"A",controller:n,controllerAs:"tyDriveawayPriceController",bindToController:!0,link:t}});angular.module("Toyota.Directives").directive("tyExpandingField",function(){return{link:function(n,t,i){var r=t.find("label"),u=t.find(".content");i.startOpen=="true"&&(r.addClass("open"),u.css("display","block"));r.on("click",function(){u.slideToggle({complete:function(){r.toggleClass("open")}})})}}});angular.module("Toyota").directive("tyGeoLocateSearch",["$location","$filter","$q","API","localstorage","Geodecode","Postcodes",function(){var n=["$scope","$rootScope","Location",function(n,t,i){n.init=function(){n.loading=!1;n.$on("GeoPostCode",function(t,i){n.geoPostCode=i});n.geoPostCode=i.get().postcode};n.init();n.showHide=function(){t.$broadcast("modal-open","change-location")}}];return{scope:!0,restrict:"A",controller:n,bindToController:!0,link:function(){}}}]);angular.module("Toyota.Directives").directive("tyIframeResizer",function(){return{scope:{heightCalculationMethod:"@tyIframeResizerHeightCalculationMethod"},link:function(n,t){function i(){t.css("width","calc(100% - 0.01px)");setTimeout(function(){t.css("width","")},0)}t.find("iframe").iFrameResize({heightCalculationMethod:n.heightCalculationMethod?n.heightCalculationMethod:undefined,initCallback:i});t.addClass("is-ready")}}});angular.module("Toyota").directive("tyLocationChange",["$q","$filter","CssMediaWatcher",function(n,t,i){var r=["$scope","$rootScope","Postcodes","Geodecode","Location","Region","Dealer","API","$attrs","$element","$window","DealerInventoryService",function(r,u,f,e,o,s,h,c,l,a,v,y){var b=this,k=function(n,t,i,u){o.update(n,t,i,u);r.postCode=n;r.suburb=t;r.state=i;r.region=u;r.dealerSelection||r.closeModal()};r.locationSaved=function(){return!!r.postCode&&r.postCode!==""};r.dealerSaved=function(){return!!r.dealer&&r.dealer.name!==""};r.saveDealer=function(n){var t=r.dealers[n];h.update(t);r.dealer=t;r.checkLocalStock.loadPage&&v.open(t.stockUrl,"_blank");r.delaySwitch=!0;r.closeModal()};r.closeModal=function(){u.$broadcast("modal-close","change-location")};r.dealerFullAddress=function(){if(!r.dealer||r.dealer.address==="")return"";var n="";return n+=r.dealer.address+", ",n+=r.dealer.city+", ",n+=r.dealer.state+" ",n+r.dealer.postCode};r.dealerFullAddressMaps=function(){return r.dealerFullAddress()!==""?r.dealer.name+", "+r.dealerFullAddress():""};r.changeDealer=function(){if(r.locationSaved()){var n=p();n.postcode!==""&&w(n);r.showLanding=!1;r.fetchDealers(r.postCode,r.suburb)}};var p=function(){return o.get()},g=function(){return h.get()},w=function(n){r.tags[0]={id:0,tagInfo:{postCode:n.postcode,state:n.state,suburb:n.suburb},text:n.suburb+", "+n.postcode+" "+n.state}},d=function(){r.dealers=[];r.tags=[];r.text="";r.loading=!1;r.geoLoading=!1;r.showLanding=!0;r.locationSet=!1;r.displayDealers=!1;r.errorInGeoLocation=!1;r.delaySwitch=!1;var n=p();n.postcode!==""&&w(n);r.postCode=n.postcode;r.suburb=n.suburb;r.dealer=g()};r.selectDealership=function(){return r.showLanding&&r.locationSaved()&&!r.selectedDealership()&&r.displayDealers?!0:!r.showLanding&&r.displayDealers?!0:!1};r.selectedDealership=function(){return r.showLanding&&r.dealer.name!=""};r.fetchDealers=function(i,u){if(r.dealerSelection){r.dealers=[];r.displayDealers=!0;r.loading=!0;var f=t("formatArgs")(ToyotaConsts.API.Info.DealersByServiceType,[i,u,"new"]);c.get(f).then(function(n){!!n.data&&n.data.results.length>0&&(r.dealers=n.data.results)},function(){}).finally(function(){if(r.checkLocalStock.loadPage){var t=[];angular.forEach(r.dealers,function(n,i){var u=y.get(n.branchCode,r.checkLocalStock.materialCode).then(function(n){n.data.success&&(r.dealers[i].stockUrl=n.data.url)});t.push(u)});n.all(t).then(function(){r.loading=!1});return}r.loading=!1;r.displayDealers=!0})}};r.onCurrentLocation=function(){r.tags=[];r.text="";r.showLanding=!1;r.geoLoading=!0;r.loading=!0;r.displayDealers=!1;e().then(function(n){n.isSuccessfull&&(r.tags=[],s(n.data.postcode,n.data.suburb).then(function(t){k(n.data.postcode,n.data.suburb,n.data.state,t);var i=p();i.postcode!==""&&w(i);r.geoLoading=!1;r.loading=!0;r.locationSet=!0;r.fetchDealers(n.data.postcode,n.data.suburb)}));deferred.resolve()},function(){r.geoLoading=!1;r.loading=!1;r.errorInGeoLocation=!0}).finally(function(){})};b.init=function(){d();r.checkLocalStock={materialCode:"",loadPage:!1};var n=p();n.postcode==""&&r.onCurrentLocation();r.dealerSelection=l.dealerSelection==="True"||r.dealerSaved()?!0:!1;r.$on("modal-open",function(){d();!r.selectedDealership()&&r.locationSaved()&&r.fetchDealers(r.postCode,r.suburb);r.locForm.$setUntouched();r.locForm.$setPristine()});r.$on("check-local-stock",function(n,t){r.checkLocalStock.materialCode=t;r.checkLocalStock.loadPage=!0});r.$on("modal-close",function(){r.checkLocalStock.loadPage=!1})};r.onTagAdd=function(n){r.tags=[];r.tags[0]=n;r.text="";r.loading=!0;s(n.tagInfo.postCode,n.tagInfo.suburb).then(function(t){r.locationSet=!0;k(n.tagInfo.postCode,n.tagInfo.suburb,n.tagInfo.state,t);r.fetchDealers(n.tagInfo.postCode,n.tagInfo.suburb)})};r.loadTags=function(t){var u=n.defer(),e,o,s,h;return(r.errorInGeoLocation=!1,t.length===0?r.tags.length===0&&(r.showLanding=!0,r.locationSet=!1,r.displayDealers=!1,r.loading=!1):(r.dealers=[],r.locationSet=!1,r.displayDealers=!1,e=i({$el:a,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}).getCurrentMedia().viewportWidth,r.showLanding===!0&&e.is.mobile&&(o=a.find(".location-info__foreground").height(),v.scrollBy(0,-o)),r.showLanding=!1),t.length<3)?(u.resolve([]),u.promise):(r.loading=!0,s=l.maxResults,h=f(t,s),h.then(function(n){r.loading=!1;u.resolve(n)}),u.promise)};b.init()}];return{scope:!0,restrict:"A",controller:r,bindToController:!0,controllerAs:"locationChangeController",link:function(){}}}]);angular.module("Toyota.Directives").directive("tyMaintainHeight",["$timeout","GlobalBreakpoints","CssMediaWatcher","$filter","$rootScope",function(n,t,i,r,u){function o(n){var t=f(n),i=t.map(function(n,t){var i=angular.element(t);return i.attr("data-ty-maintain-height-group")}).toArray();return i=r("arrayUnique")(i).sort(function(n,i){var r=t.filter('[data-ty-maintain-height-group="'+n+'"]:first').parents().length,u=t.filter('[data-ty-maintain-height-group="'+i+'"]:first').parents().length;return u-r}),i.map(function(n){return t.filter('[data-ty-maintain-height-group="'+n+'"]')})}function s(n){function t(){return Math.round(Math.random()*255).toString(16)}var i,r;n.length&&(i=Math.max.apply(null,n.map(function(n,t){var i=t.getBoundingClientRect();return Math.ceil((i.bottom-i.top)*100)/100})),e&&(r="#"+t()+t()+t(),angular.element(n).css("outline","3px solid "+r)),angular.forEach(n,function(n){var t=n.getBoundingClientRect(),r=t.bottom-t.top;r!==i&&angular.element(n).css("height",i+"px")}))}function h(n){f(n).css("height","");e&&f(n).css("outline","")}function f(n){return n.find("[data-ty-maintain-height-group]")}var e=!1;return{scope:!0,link:function(r,f,c){function l(){if(h(f),v.getCurrentMedia().viewportWidth.is.maintainHeightsActive){var n=o(f);e&&console.log("tyMaintainHeight.repaint about to updateGroupSize for ",n.length," groups");angular.forEach(n,s)}}var y=t.parseCompoundExpression(c.tyMaintainHeightBreakpoints||"sm+"),v=i({$el:angular.element(".ty-global-breakpoint-sensor"),pseudoEl:"before",breakpointRegexes:{maintainHeightsActive:"^("+y.join("|")+")$"}}),a;if(u.$on("force-maintain-height",function(t,i){i===c.tyMaintainHeightId&&n(l)}),a=c.tyMaintainHeightOn&&c.tyMaintainHeightOn.split(" ")||[],a.indexOf("breakpoint")!==-1)v.on("didChange",function(){n(l)});if(a.indexOf("resize")!==-1)$(window).on("resize",function(){n(l)});l()}}}]);angular.module("Toyota.Directives").directive("tyModal",function(){var n=["$scope","$timeout","$window","$element","$rootScope","CssMediaWatcher","ScrollLock",function(n,t,i,r,u,f,e){function h(){o.isOpen=!1;n.scrollPosition=0}function s(){o.isOpen?e.lock({allowInnerScrollingInIos:!0,preventElasticScrollingInIos:!1}):e.unlock()}var o=this,c=r.find(".ty-modal"),l=f({$el:c,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}});o.open=function(){o.isOpen=!0;s()};o.close=function(){o.isOpen=!1;s()};o.show=function(){u.$broadcast("modal-open",o.modalId)};n.$on("modal-open",function(i,u){(n.scrollPosition=$(window).scrollTop(),u===o.modalId)&&t(function(){r.find(".ty-modal-panel__body").scrollTop(0);o.open();$(window).width()<768&&$(window).scrollTop(0)},0)});n.$on("modal-close",function(i,r){r===o.modalId&&(t(function(){o.close();var t=l.getCurrentMedia().viewportWidth;t.is.mobile&&$(window).scrollTop(n.scrollPosition)},0),window.setTimeout(function(){document.activeElement.blur()},50),u.$broadcast("modal-closed",r))});n.closeModal=function(n){u.$broadcast("modal-close",n)};h()}];return{scope:{modalId:"@modalId",title:"@modalTitle"},restrict:"A",controller:n,bindToController:!0,controllerAs:"ctl",template:'<div class="ty-modal" data-ng-class="{\'is-open\': ctl.isOpen}"><div class="ty-modal__overlay" data-ng-click="closeModal(ctl.modalId)"><\/div><div class="ty-modal__panel"><div class="ty-modal-panel"><div class="ty-modal-panel__head"><div class="ty-modal-panel-head"><span class="ty-modal-panel-head__title">{{ctl.title}}<\/span><span class="ty-modal-panel-head__close" data-ng-click="closeModal(ctl.modalId)"><img src="/Assets/Toyota/MainSite/images/icons/Close.svg" /><\/span><\/div><\/div><div class="ty-modal-panel__body"><div data-ng-transclude><\/div><\/div><\/div><\/div><\/div>',transclude:!0,link:function(n,t,i){angular.element("[href=#"+i.modalId+"]").on("click",function(t){t.preventDefault();n.ctl.show()})}}});angular.module("Toyota.Directives").directive("mouseDetected",["$rootScope","MouseDetectionService",function(n){return{restrict:"A",scope:{onMouseDetected:"&mouseDetected"},link:function(t){n.$on("did-detect-mouse",function(){t.onMouseDetected();t.$apply()})}}}]);angular.module("Toyota.Directives").directive("infiniteScroll",["$rootScope","$window","$timeout",function(n,t,i){return{link:function(r,u,f){var o,e,h,s;t=angular.element(t);h=0;f.infiniteScrollDistance!=null&&r.$watch(f.infiniteScrollDistance,function(n){return h=parseInt(n,10)});s=!0;o=!1;f.infiniteScrollDisabled!=null&&r.$watch(f.infiniteScrollDisabled,function(n){return s=!n,s&&o?(o=!1,e()):void 0});e=function(){var e,c,i,l;return(l=t.height()+t.scrollTop(),e=u.offset().top+u.height(),c=e-l,i=c<=t.height()*h,i&&s)?n.$$phase?r.$eval(f.infiniteScroll):r.$apply(f.infiniteScroll):i?o=!0:void 0};t.on("scroll",e);return r.$on("$destroy",function(){return t.off("scroll",e)}),i(function(){if(f.infiniteScrollImmediateCheck){if(r.$eval(f.infiniteScrollImmediateCheck))return e()}else return e()},0)}}}]);angular.module("Toyota.Directives").directive("tyNumberAnimator",["$filter",function(n){function t(t){t.animatedValue=0;t.interimValue={value:0};t.$watch("source",function(i){isNaN(parseFloat(i))||TweenLite.to(t.interimValue,1,{ease:Expo.easeOut,value:i,onUpdate:function(){t.animatedValue=n("formatPrice")(t.interimValue.value).split("").map(function(n){return n.match(/[0-9]/)?'<span class="ty-number-animator-char ty-number-animator-char--digit">'+n+"<\/span>":'<span class="ty-number-animator-char">'+n+"<\/span>"}).join("");t.$digest()}})})}return{scope:{source:"<ngModel"},restrict:"E",template:'<span data-ng-bind-html="animatedValue"><\/span>',link:function(n,i,r){n.source=0;t(n,i,r)}}}]);angular.module("Toyota.Directives").directive("tyPostRepeat",["$rootScope",function(n){return{link:function(t,i,r){t.$last&&n.$broadcast("ng-repeat-finished",r.repeatId)}}}]);angular.module("Toyota.Directives").directive("tyStickToTop",["$window","ScrollLock",function(n,t){return{link:function(i,r,u){function h(n){var t=n.get(0).getBoundingClientRect(),i=t.bottom-t.top,r=parseInt(n.css("margin-top").match(/([0-9]+(\.[0-9])?)/g)[0],10),u=parseInt(n.css("margin-bottom").match(/([0-9]+(\.[0-9])?)/g)[0],10);return i+r+u}function a(n){o.css({height:n?h(r)+"px":"0",visibility:n?"":"hidden"})}function v(t){var i=$("html");i.css("overflow-anchor","none");n.clearTimeout(l);t.isFixed?r.css({position:"fixed",top:t.topWhenFixed,transform:"translate3d(0,0,0)"}):r.css({position:"",top:0,transform:"translate3d(0,0,0)"});a(t.isPlaceholderTopOutsideViewport||t.isFixed);l=n.setTimeout(function(){i.css("overflow-anchor","")},100)}function e(){if(!t.isLocked){var i=$(".ty-stick-to-top-placeholder").toArray(),r=i.slice(0,i.indexOf(o.get(0))),n=0;angular.forEach(r,function(t){n+=h($(t))});f.isPlaceholderTopOutsideViewport=o.get(0).getBoundingClientRect().top<n;f.isFixed=f.isPlaceholderTopOutsideViewport;f.topWhenFixed=n;s&&$.extend(f,s);v(f)}}function c(n){s=n===null||typeof n=="undefined"?undefined:n;e()}function y(){f={};r.data("tyStickToTop",p);o=$('<div class="'+(u.tyStickToTopPlaceholderClass||"")+' ty-stick-to-top-placeholder"><\/div>');r.before(o);var n=$(window);n.on("scroll",e);n.on("resize",e);e()}var f,s,l=null,p={setRepaintOverrides:c,clearRepaintOverrides:function(){c(null)}},o;y();i.$on("$destroy",function(){o.remove();var n=$(window);n.off("scroll",e);n.off("resize",e)})}}}]);angular.module("Toyota.Directives").directive("tyStyleguide",["$rootScope","localstorage",function(n,t){return{restrict:"A",link:function(n,i){var r=i.find("[role=tab]");t.isExists("styleguide-tab")&&r.filter("[href=#"+t.get("styleguide-tab").val+"]").click();r.on("click",function(){var n=$(this);t.set("styleguide-tab",n.attr("href").match(/^#(.*)/)[1])})}}}]);angular.module("Toyota.Directives").directive("tySvgIcon",["$timeout","$compile",function(n,t){var i={"location-pin":{replaceFill:!0,viewBox:"0 0 35 44",defaultWidth:11,defaultHeight:16,content:'<path d="M17.7058824,0 C8.43868395,0 0.882352941,7.52258065 0.882352941,16.7483871 C0.882352941,24.1290323 11.2901296,37.6129032 15.7098704,43.0064516 C16.1375872,43.5741935 16.9930209,44 17.7058824,44 C18.4187438,44 19.2741775,43.716129 19.7018943,43.0064516 C24.1216351,37.6129032 34.5294118,24.1290323 34.5294118,16.7483871 C34.5294118,7.52258065 26.9730808,0 17.7058824,0 Z M22.8384845,15.4709677 C22.8384845,18.3096774 20.557328,20.5806452 17.7058824,20.5806452 C14.8544367,20.5806452 12.5732802,18.3096774 12.5732802,15.4709677 C12.5732802,12.6322581 14.8544367,10.3612903 17.7058824,10.3612903 C20.557328,10.3612903 22.8384845,12.6322581 22.8384845,15.4709677 Z"><\/path>'},tooltip:{replaceFill:!0,viewBox:"2 0 26 26",defaultWidth:19,defaultHeight:19,content:'<path d="M15,26 C7.82029825,26 2,20.1797017 2,13 C2,5.82029825 7.82029825,0 15,0 C22.1797017,0 28,5.82029825 28,13 C28,20.1797017 22.1797017,26 15,26 Z M15,24 C21.0751322,24 26,19.0751322 26,13 C26,6.92486775 21.0751322,2 15,2 C8.92486775,2 4,6.92486775 4,13 C4,19.0751322 8.92486775,24 15,24 Z" fill-rule="nonzero"><\/path><path d="M13.9497871,12.8104327 L13,12.8104327 L13,11.1500134 L16.0065204,11.1500134 L16.0065204,18.2700005 L13.9497871,18.2700005 L13.9497871,12.8104327 Z M13.9087891,10.0294013 C13.7037981,9.79707809 13.6013041,9.51692786 13.6013041,9.18894217 C13.6013041,8.86095648 13.7060757,8.58080624 13.9156221,8.34848305 C14.1251685,8.11615985 14.4394834,8 14.8585763,8 C15.2594477,8 15.5657908,8.11615985 15.7776149,8.34848305 C15.989439,8.58080624 16.0953494,8.86095648 16.0953494,9.18894217 C16.0953494,9.51692786 15.9905778,9.79480045 15.7810314,10.0225683 C15.571485,10.2503361 15.264003,10.3642183 14.8585763,10.3642183 C14.4303727,10.3642183 14.1137802,10.2526138 13.9087891,10.0294013 Z"><\/path>'},close:{replaceStroke:!0,viewBox:"0 0 17 17",defaultWidth:14,defaultHeight:14,content:'<g stroke-width="3" stroke-linecap="square" transform="translate(3.000000, 3.000000)"><path d="M10.8971354,5.56380208 L5.33333333,2.13162821e-14" transform="translate(8.115234, 2.781901) rotate(-90.000000) translate(-8.115234, -2.781901) "><\/path><path d="M5.56380208,2.13162821e-14 L8.8817842e-16,5.56380208" transform="translate(2.781901, 2.781901) rotate(-90.000000) translate(-2.781901, -2.781901) "><\/path><path d="M5.56380208,10.8971354 L0,5.33333333" transform="translate(2.781901, 8.115234) rotate(-90.000000) translate(-2.781901, -8.115234) "><\/path><path d="M10.8971354,5.33333333 L5.33333333,10.8971354" transform="translate(8.115234, 8.115234) rotate(-90.000000) translate(-8.115234, -8.115234) "><\/path><\/g>'},"alert-info":{replaceFill:!0,viewBox:"0 0 64 64",defaultWidth:64,defaultHeight:64,content:'<path d="M32,64A32,32,0,1,1,64,32,32,32,0,0,1,32,64ZM32,2.016A29.984,29.984,0,1,0,61.984,32,29.984,29.984,0,0,0,32,2.016ZM31.634,24.7a2.316,2.316,0,0,1-1.7-.71,2.415,2.415,0,1,1,3.415-3.415,2.316,2.316,0,0,1,.71,1.7A2.423,2.423,0,0,1,31.634,24.7Zm1.852,21.66H30.16V30.895H28.05V28.178h5.436V46.362Z"/>'}},r='<svg class="ty-svg-icon" data-ng-attr-width="{{width}}" data-ng-attr-height="{{height}}"data-view-box="{{viewBox}}"data-ng-class="{ \'ty-svg-icon--replace-fill\': replaceFill, \'ty-svg-icon--replace-stroke\': replaceStroke }">',u="<\/svg>";return{restrict:"E",scope:{},link:function(n,f,e){var o=i[e.iconId],s;n.width=parseInt(e.iconWidth?e.iconWidth:o.defaultWidth,10);n.height=parseInt(e.iconHeight?e.iconHeight:o.defaultHeight,10);n.viewBox=o.viewBox;n.replaceFill=o.replaceFill;n.replaceStroke=o.replaceStroke;s=o.content;f.replaceWith(t(r+s+u)(n))}}}]);angular.module("Toyota.Directives").directive("tyToasts",["ToastManager","$window",function(n,t){var i=function(){var i=this;i.toasts=[];i.isVisible=!0;i.removeToast=function(n){n.timeout&&t.clearTimeout(n.timeout);i.toasts.splice(i.toasts.indexOf(n),1)};i.addToast=function(n,r,u){var e=function(){i.removeToast(f)},f={timeout:r?t.setTimeout(e,r):null,message:n,group:u};return i.toasts.unshift(f),f};i.removeToastsByGroup=function(n){i.toasts.filter(function(t){return typeof n=="undefined"||t.group===n}).forEach(function(n){i.removeToast(n)})};n.registerController(i)};return{restrict:"E",scope:{},bindToController:{message:"@message"},controller:i,controllerAs:"ctrl",template:'<div class="ty-toasts" data-ty-stick-to-top><div class="ty-toast-container" data-ng-repeat="toast in ctrl.toasts"><div class="ty-toast-spacing"><\/div><div class="ty-toast"><span class="ty-toast__icon"><svg class="ty-svg-icon ty-svg-icon--block ty-svg-icon--replace-fill" width="30px" height="26px" viewBox="0 0 30 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g fill="#E1E1E3"><g transform="translate(1.000000, 1.000000)"><path d="M14.8661856,1.50249915 C14.7783574,1.35026356 14.651958,1.22386424 14.4997225,1.13603602 C14.0213414,0.860046929 13.4098035,1.02411806 13.1338144,1.50249915 L1.59663457,21.5002775 C1.50896926,21.6522307 1.46282016,21.824572 1.46282016,22 C1.46282016,22.5522847 1.91053541,23 2.46282016,23 L25.5371798,23 C25.7126078,23 25.8849491,22.9538509 26.0369023,22.8661856 C26.5152834,22.5901965 26.6793545,21.9786586 26.4033654,21.5002775 L14.8661856,1.50249915 Z M16.5985568,0.503054245 L28.1357366,20.5008326 C28.9637039,21.9359759 28.4714905,23.7705895 27.0363472,24.5985568 C26.5804876,24.8615527 26.0634638,25 25.5371798,25 L2.46282016,25 C0.805965907,25 -0.537179843,23.6568542 -0.537179843,22 C-0.537179843,21.473716 -0.398732526,20.9566922 -0.135736601,20.5008326 L11.4014432,0.503054245 C12.2294105,-0.932089024 14.0640241,-1.42430242 15.4991674,-0.596335153 C15.9558741,-0.332850483 16.3350721,0.0463474835 16.5985568,0.503054245 Z" id="Triangle-2" fill-rule="nonzero"><\/path><path d="M12.9365234,8.90332031 L15.1787109,8.90332031 L14.8710938,15.9648438 L13.1484375,15.9648438 L12.9365234,8.90332031 Z M13.1210938,18.890625 C12.9342439,18.658202 12.8408203,18.3688168 12.8408203,18.0224609 C12.8408203,17.676105 12.9365225,17.3912772 13.1279297,17.1679688 C13.3193369,16.9446603 13.6155579,16.8330078 14.0166016,16.8330078 C14.4085306,16.8330078 14.7001944,16.9446603 14.8916016,17.1679688 C15.0830088,17.3912772 15.1787109,17.676105 15.1787109,18.0224609 C15.1787109,18.3779315 15.0830088,18.6673166 14.8916016,18.890625 C14.7001944,19.1139334 14.4085306,19.2255859 14.0166016,19.2255859 C13.6155579,19.2255859 13.3170583,19.1139334 13.1210938,18.890625 Z" id="!"><\/path><\/g><\/g><\/svg><\/span><span class="ty-toast__message">{{toast.message}}<\/span><span class="ty-toast__close" data-ng-click="ctrl.removeToast(toast)"><svg class="ty-svg-icon ty-svg-icon--block ty-svg-icon--replace-stroke" width="17px" height="17px" viewBox="0 0 17 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="square"><g id="Close" stroke="#4D4F53" stroke-width="3"><g id="Group" transform="translate(3.000000, 3.000000)"><path d="M10.8971354,5.56380208 L5.33333333,2.13162821e-14" id="Line" transform="translate(8.115234, 2.781901) rotate(-90.000000) translate(-8.115234, -2.781901) "><\/path><path d="M5.56380208,2.13162821e-14 L8.8817842e-16,5.56380208" id="Line" transform="translate(2.781901, 2.781901) rotate(-90.000000) translate(-2.781901, -2.781901) "><\/path><path d="M5.56380208,10.8971354 L0,5.33333333" id="Line" transform="translate(2.781901, 8.115234) rotate(-90.000000) translate(-2.781901, -8.115234) "><\/path><path d="M10.8971354,5.33333333 L5.33333333,10.8971354" id="Line" transform="translate(8.115234, 8.115234) rotate(-90.000000) translate(-8.115234, -8.115234) "><\/path><\/g><\/g><\/g><\/svg><\/span><\/div><\/div><\/div>',link:function(){}}}]);angular.module("Toyota.Directives").directive("tyTooltipCallout",["$rootScope","CssMediaWatcher","MouseDetectionService","$window","$timeout",function(n,t,i,r,u){var f=["$scope","$element","$timeout",function(t,i,r){function f(n){u.$lastCalloutOrigin=n;u.isOpen=!0;u.$lastCalloutOrigin.append(i);r(function(){u.updateBoxLeft()})}var u=this;u.boxWidthIsFluid=null;u.isOpen=!1;u.isMouseDetected=!1;u.$lastCalloutOrigin=undefined;n.$on("did-detect-mouse",function(){u.isMouseDetected=!0});u.updateBoxLeft=function(){if(u.$lastCalloutOrigin){var a=i.find(".ty-tooltip-callout__internal-origin"),n=i.find(".ty-tooltip-callout__box"),v=a.get(0).getBoundingClientRect(),e=u.$lastCalloutOrigin.get(0).getBoundingClientRect(),o=n.get(0).getBoundingClientRect(),t=o.right-o.left,r=document.body.clientWidth,s=e.left+t/2,h=e.left-t/2,f=30,c=f,l=r-f,y=h<c,p=s>l;r<t+2*f?n.css("left",-v.left+(r-t)/2):p?n.css("left",l-s):y?n.css("left",c-h):n.css("left",0)}};u.open=function(n){r(function(){var t=i.parent();t.get(0)!==n.get(0)&&i.hasClass("ng-hide-add")?r(function(){f(n)},600):f(n)})};u.close=function(){r(function(){u.isOpen=!1})};u.close()}];return{restrict:"E",scope:{},bindToController:{tooltipCalloutId:"@"},controller:f,controllerAs:"ctl",transclude:!0,replace:!0,template:'<div class="ty-tooltip-callout" data-ng-show="ctl.isOpen"><span class="ty-tooltip-callout__internal-origin"><\/span><span class="ty-tooltip-callout__nub-fill"><\/span><span class="ty-tooltip-callout__nub-border-and-shadow"><\/span><div class="ty-tooltip-callout__box"><span class="ty-tooltip-callout__close" data-ng-if="!ctl.isMouseDetected" data-ng-click="ctl.close();"><ty-svg-icon icon-id="close"><\/ty-svg-icon><\/span><div class="ty-tooltip-callout__content"><ng-transclude><\/ng-transclude><\/div><\/div><\/div>',link:function(n,i,f,e,o){function a(n){var t=n.attr("data-ty-tooltip-callout-origin"),i=null;return t&&(i=$(t)),i}function v(n){return $(n).closest(c)}function y(){function n(n){s.isMouseDetected&&(h&&u.cancel(h),s.open(a(v(n.target))||s.$lastCalloutOrigin))}function f(){s.isMouseDetected&&(h&&u.cancel(h),h=u(s.close,200))}l.on("click",c,function(n){if(s.isMouseDetected){n.preventDefault();return}s.open(a(v(n.target)));n.preventDefault()});l.on("click."+s.tooltipCalloutId,"*",function(n){if(!s.isMouseDetected&&s.isOpen){var t=$(n.target);t.closest(i).length===0&&s.close();n.preventDefault()}});l.on("mouseenter",c,n);i.on("mouseenter",n);l.on("mouseleave",c,f);i.on("mouseleave",f);t({$el:i,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}).on("didInitOrChange",function(n,t){s.boxWidthIsFluid=t.viewportWidth.is.mobile;s.updateBoxLeft()});$(r).on("resize",s.updateBoxLeft)}var c='[href="#'+f.tooltipCalloutId+'"]',s=n.ctl,l=$("body"),h;o(function(n){i.find("ng-transclude").after(n).remove()});y()}}}]);angular.module("Toyota.Directives").directive("tyTooltipIcon",["$timeout",function(n){var t=function(){function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}var i=this;n(function(){i.calloutOriginId="ty-tooltip-callout-origin-"+t()})};return{restrict:"E",scope:{},bindToController:{href:"@href"},controller:t,controllerAs:"ctl",replace:!0,transclude:!0,template:'<span class="ty-tooltip-icon"><span id="{{ctl.calloutOriginId}}" class="ty-tooltip-icon__callout-origin"><ng-transclude><\/ng-transclude><\/span><a href="{{ctl.href}}" data-ty-tooltip-callout-origin="#{{ctl.calloutOriginId}}"><ty-svg-icon icon-id="tooltip"><\/ty-svg-icon><\/a><\/span>',link:function(n,t){$(t).removeAttr("href")}}}]);angular.module("Toyota.Directives").directive("tyFancyAccordion",["InfoService","CssMediaWatcher",function(n,t){return{restrict:"A",scope:!0,link:function(i,r){var e=!1,u={},f;u.$elAboveFixedHeader=$(".navbar-default");u.$next=null;u.$prev=null;u.isOpen=!1;u.$controls=r.find(".ty-fancy-accordion__controls");u.controlsDistanceFromPageTop=null;u.controlsDistanceFromPrevBottom=null;u.controlsDistanceFromContentTop=null;u.controlsDistanceFromContentBottom=null;u.$content=r.find(".ty-fancy-accordion__container");u.$toggleButton=r.find(".ty-fancy-accordion-button");u.baseDuration=1100;u.totalDuration=u.baseDuration*1.3;u.pullEndYpercentViewportHeight=.6;f=n.get(ToyotaConsts.InfoKeys.SecondaryNavMetrics);u.navBarHeight=f?f.navbarHeight||0:0;u.isTopLevelLayoutElement=function(){var t=this,i=$(t),n;return i.filter('script, noscript, .ty-secondary-nav[style*="fixed"]').length?!1:(n=window.getComputedStyle(t),n.position==="fixed"||n.position==="absolute"||n.display==="none")?!1:!0};u.getPrevOne=function(){return r.prevAll().filter(u.isTopLevelLayoutElement).first()};u.getNextOne=function(){return r.nextAll().filter(u.isTopLevelLayoutElement).first()};u.ensureCustomEasingIsAvailable=function(){$.easing.fancyAccordionEasing=function(n,t,i,r,u){return t==0?i:t==u?i+r:(t/=u/2)<1?r/2*Math.pow(3,9*(t-1))+i:r/2*(-Math.pow(3,-9*--t)+2)+i}};u.init=function(){$(window).on("resize",function(){u.updateScrollTopDependentControlsPositioningClasses()});t({$el:r,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}).on("didInitOrChange",function(n,t){t.viewportWidth.is.desktop?(u.controlsDistanceFromPageTop=35,u.controlsDistanceFromPrevBottom=35,u.controlsDistanceFromContentTop=35,u.controlsDistanceFromContentBottom=35):(u.controlsDistanceFromPageTop=28,u.controlsDistanceFromPrevBottom=28,u.controlsDistanceFromContentTop=28,u.controlsDistanceFromContentBottom=28)});u.enableToggleButton()};u.enableToggleButton=function(){u.$toggleButton.on("click",function(){u.toggleAccordion()})};u.disableToggleButton=function(){u.$toggleButton.off("click")};u.toggleAccordion=function(){u.ensureCustomEasingIsAvailable();u.isOpen?u.closeAccordion():u.openAccordion();u.isOpen=!u.isOpen};u.debugInfo=function(){e&&console.log.apply(this,arguments)};u.solveAllVisiblePrevOrNext=function(n,t,i){var e=n==="next",f=e?r.nextAll().filter(u.isTopLevelLayoutElement):Array.prototype.reverse.call(r.prevAll().filter(u.isTopLevelLayoutElement));typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=window.innerHeight);f=f.filter(function(n,r){var u=r.getBoundingClientRect();return u.top>t&&u.top<=i||u.bottom>t&&u.bottom<=i||u.top<t&&u.bottom>i});u.debugInfo("    solveAllVisiblePrevOrNext: ",n,f.toArray());u.debugInfo("      topLimit: ",t,"bottomLimit:",i);u.debugInfo("      $"+n+".length ===",f.length);e?u.$next=f:u.$prev=f};u.solvePrevAndNext=function(n,t){u.solveAllVisiblePrevOrNext("prev",n,t);u.solveAllVisiblePrevOrNext("next",n,t)};u.getBoundingClientRectAll=function(n){return u.boundingBoxOfUnionOfRects(u.getBoundingClientRects(n))};u.getBoundingClientRects=function(n){if(!n.length)throw new Error("Can't get bounding union for empty $els");var t=[];return n.each(function(){var n=this.getBoundingClientRect();t.push(n)}),t};u.boundingBoxOfUnionOfRects=function(n){var t,r,i;if(!n.length)throw new Error("Can't get union for empty array of rects");if(t={top:n[0].top,left:n[0].left,right:n[0].right,bottom:n[0].bottom},n.length===1)return t;for(r=1;r<n.length;r++)i=n[r],t={top:i.top<t.top?i.top:t.top,left:i.left<t.left?i.left:t.left,right:i.right>t.right?i.right:t.right,bottom:i.bottom>t.bottom?i.bottom:t.bottom};return t};u.getHeightOfElAboveFixedHeader=function(){return u.$elAboveFixedHeader.length?u.$elAboveFixedHeader.height():0};u.openAccordion=function(){function f(){u.enableToggleButton();u.unfreezeScrollingJustForAnimation();u.updateScrollTopDependentControlsPositioningClasses()}var n,t;u.debugInfo("openAccordion (only one case) -- pushing next slice out by up to contentHeight = ",t);u.debugInfo("  Selecting visible elements before and after the accordion into $prev and $next arrays");u.solvePrevAndNext();var i=u.$prev.length?u.getBoundingClientRects(u.$prev):null,r=u.$next.length?u.getBoundingClientRects(u.$next):null,e=u.$controls[0].getBoundingClientRect();u.$content.css({height:"auto",visibility:"hidden"});n=u.$content[0].getBoundingClientRect();t=n.bottom-n.top;u.$content.css({height:"",visibility:""});u.disableToggleButton();u.freezeScrollingJustForAnimation();u.$content.addClass("is-open");u.$controls.addClass("is-open");u.$toggleButton.addClass("is-open");u.startUpdatingControlsPositioningOnScroll();u.debugInfo("  Triggering animations");$.when(u.animateContentFade("fade-in"),u.moveControlsTo(e,n.top+u.controlsDistanceFromContentTop),i?u.pushPrevFrom(i,n.top,0):$.when(),r?u.pushNextFrom(r,n.top,t):$.when()).done(f)};u.freezeScrollingJustForAnimation=function(){var n=window.innerWidth-document.body.clientWidth;$("body").on("mousewheel.freezeScrolling DOMMouseScroll.freezeScrolling keydown.freezeScrolling touchmove.freezeScrolling",function(){return!1})};u.unfreezeScrollingJustForAnimation=function(){$("body").off("mousewheel.freezeScrolling DOMMouseScroll.freezeScrolling keydown.freezeScrolling touchmove.freezeScrolling")};u.closeAccordion=function(){function ct(){u.enableToggleButton();u.$content.removeClass("is-open");u.unfixEl(u.$content);u.unfreezeScrollingJustForAnimation()}var r=window.innerHeight,v=u.getPrevOne(),c=u.getNextOne(),y,p,f,lt,i,t,w,b,l,k,d,ot,st,g,nt,tt,it,rt,ut,n,o,s,e,h;for(y=u.isOnScreen(v),p=u.isOnScreen(c),f=u.$content[0].getBoundingClientRect(),lt=f.bottom-f.top,e=!0,h=1,i=Math.min(0,f.top),t=Math.max(r,f.bottom),y?(u.debugInfo("closeAccordion -- case prevOnScreen"),t+=r):p?(u.debugInfo("closeAccordion -- case nextOnScreen"),i-=r,t+=r):(u.debugInfo("closeAccordion -- case neither prevOnScreen nor nextOnScreen"),i-=r,t+=r),w=v[0].getBoundingClientRect(),b=c[0].getBoundingClientRect(),k=w.bottom,d=b.top,y?(u.debugInfo("  Planning to pull both slices (mainly just $nextOne) toward meetInTheMiddleY = prevBottom =",k),n=k,s=v,o=w.top):p?(u.debugInfo("  Planning to pull both slices (mainly just $prevOne) toward meetInTheMiddleY = nextTop =",d),n=d,s=c,o=b.top):(u.debugInfo("  Planning to pull both slices toward meetInTheMiddleY =",u.pullEndYpercentViewportHeight," * viewportHeight =",n),n=r*u.pullEndYpercentViewportHeight,s=c,o=n),u.debugInfo("    Will bring top of",s,"to position",o);e;){u.debugInfo("  Solve $prev and $next attempt #",h,"(topLimit=",i,", bottomLimit=",t,")");u.solvePrevAndNext(i,t);e=!1;g=u.getBoundingClientRects(u.$prev);nt=u.getBoundingClientRects(u.$next);tt=u.boundingBoxOfUnionOfRects(g);it=u.boundingBoxOfUnionOfRects(nt);rt=tt.bottom-tt.top;ut=it.bottom-it.top;var a=n,ft=i,et=t,at=rt>=n,vt=ut>=r-n,ht=document.body.getBoundingClientRect().top+u.getHeightOfElAboveFixedHeader(),yt=ht+$(document).height()-u.getHeightOfElAboveFixedHeader();if(at?vt||(n=r-ut,t=t+r,t=Math.min(Math.max(et,t),yt),u.debugInfo("    $next not tall enough to fill viewport bottom, we're off by",a-n),u.debugInfo("      Moving meetInTheMiddleY from",a,"down to",n," and extending bottomLimit downwards from",et,"to",t),e=!0):(n=rt,i=i-r,i=Math.max(Math.min(ft,i),ht),u.debugInfo("    $prev not tall enough to fill viewport top, we're off by",a-n),u.debugInfo("      Moving meetInTheMiddleY from",a,"up to",n," and extending topLimit upwards from",ft,"to",i),e=!0),ft===i&&et===t){u.debugInfo("    STOPPING at solution attempt #"+h+"");u.debugInfo("    We've included as much as we need to into $prev / $next -- everything from topLimit =",i,"down to bottomLimit =",t,"(that's",t-i,"px of a",$(document).height(),"px tall document)");break}if(h>=3){u.debugInfo("    Giving up after 3 solution attempts. Too much!");break}e&&h++}l=u.$controls[0].getBoundingClientRect();ot=f.top;st=l.bottom-l.top;u.disableToggleButton();u.freezeScrollingJustForAnimation();u.fixElAt(u.$content,ot);u.stopUpdatingControlsPositioningOnScroll();u.$controls.removeClass("is-open");u.$toggleButton.removeClass("is-open");u.debugInfo("  Triggering animations");$.when(u.animateContentFade("fade-out"),u.pullPrevTo(g,n),u.pullNextTo(nt,n),u.moveControlsTo(l,n-st-u.controlsDistanceFromPrevBottom)).done(function(){var n=u.getHeightOfElAboveFixedHeader();$(window).scrollTop()>n&&$(window).scrollTop(Math.max(s.offset().top-o,n));ct()})};u.fixElAt=function(n,t){n.addClass("is-fixed");n.css("top",t)};u.unfixEl=function(n){n.removeClass("is-fixed");n.css("top","")};u.pushPrevFrom=function(n,t,i){u.debugInfo("    pushPrevFrom");var f=u.boundingBoxOfUnionOfRects(n),r=f.bottom-f.top;return u.$prev.data("animateDebugTag","prev"),u.animateAll(u.$prev,n,t-r,Math.max(-r,t-r+i),"ty-fancy-accordion-prev-next-is-fixed")};u.pushNextFrom=function(n,t,i){return u.debugInfo("    pushNextFrom"),u.$next.data("animateDebugTag","next"),u.animateAll(u.$next,n,t,Math.min(window.innerHeight,t+i),"ty-fancy-accordion-prev-next-is-fixed")};u.pullPrevTo=function(n,t){u.debugInfo("    pullPrevTo");var i=u.boundingBoxOfUnionOfRects(n),r=i.bottom-i.top;return u.$prev.data("animateDebugTag","prev"),u.animateAll(u.$prev,n,Math.max(i.top,-r),t-r,"ty-fancy-accordion-prev-next-is-fixed")};u.pullNextTo=function(n,t){u.debugInfo("    pullNextTo");var i=u.boundingBoxOfUnionOfRects(n);return u.$next.data("animateDebugTag","next"),u.animateAll(u.$next,n,Math.min(i.top,window.innerHeight),t,"ty-fancy-accordion-prev-next-is-fixed")};u.moveControlsTo=function(n,t){return u.debugInfo("    moveControlsTo"),u.$controls.data("animateDebugTag","controls"),u.animate(u.$controls,n.top,t,"is-fixed")};u.animateAll=function(n,t,i,r,f){var e=[],o=u.boundingBoxOfUnionOfRects(t);return n.each(function(n){var h=$(this),s=t[n],c=s.top-o.top,l=s.bottom-s.top,a=i+c,v=r+c;h.data("animateDebugTagNum",n);e.push(u.animate(h,a,v,f,l))}),$.when.apply($,e)};u.animate=function(n,t,i,r,f){u.debugInfo("      animate:",(n.data("animateDebugTag")||"")+(typeof n.data("animateDebugTagNum")!="undefined"?"["+n.data("animateDebugTagNum")+"] ===":""),n[0],"from",t,"->",i);var o=$.Deferred(),e=null;return f&&(e=$("<div><\/div>").css({height:f}),n.before(e)),n.addClass(r),n.css("top",t+"px"),n.animate({top:i},{duration:u.baseDuration,easing:"fancyAccordionEasing",complete:function(){n.removeClass(r);n.css("top","");e&&e.remove();o.resolve()}}),o.promise()};u.updateScrollTopDependentControlsPositioningClasses=function(){var f=r[0].getBoundingClientRect().top,e=r[0].getBoundingClientRect().bottom,n=u.$controls[0].getBoundingClientRect(),o=n.bottom-n.top,s=u.controlsDistanceFromPageTop+o,c=window.innerHeight,h=f<0+u.navBarHeight,t=s<e-u.controlsDistanceFromContentBottom-u.navBarHeight,i;u.$controls.toggleClass("is-locked-to-content-bottom",!t);u.$controls.toggleClass("is-fixed",h&&t);i=u.$controls.hasClass("is-fixed")?u.controlsDistanceFromPageTop+u.navBarHeight+"px":u.$controls.hasClass("is-locked-to-content-bottom")?"auto":"";u.$controls.css("top",i)};u.startUpdatingControlsPositioningOnScroll=function(){u.updateScrollTopDependentControlsPositioningClasses();window.addEventListener("scroll",u.updateScrollTopDependentControlsPositioningClasses)};u.stopUpdatingControlsPositioningOnScroll=function(){window.removeEventListener("scroll",u.updateScrollTopDependentControlsPositioningClasses);u.$controls.removeClass("is-locked-to-content-bottom").removeClass("is-fixed")};u.isOnScreen=function(n){var t=n[0].getBoundingClientRect();return t.bottom<=window.innerHeight&&t.bottom>=0||t.top<=window.innerHeight&&t.top>=0};u.animateContentFade=function(n){var s=$.Deferred(),h=n==="fade-in",t=$('<div class="ty-fancy-accordion-overlay"><\/div>'),i,f,e,o,c;return r.append(t),c=h?u.totalDuration-u.baseDuration-100:0,h?(i=1,f=0,e=u.baseDuration,o="easeInOutExpo"):(i=0,f=1,e=u.baseDuration,o="easeInOutExpo"),t.css("opacity",i),setTimeout(function(){t.animate({opacity:f},e,o,function(){t.remove();s.resolve()})},c),s.promise()};u.init()}}}]);angular.module("Toyota.Directives").directive("tyFindADealerPage",["CssMediaWatcher","$timeout","$rootScope",function(n,t){var i=["$scope","$attrs","$element","$q","$filter","Postcodes","API",function(n,i,r,u,f,e,o){function y(){n.findADealer={searchOptions:{tagfieldTags:[],stateFilter:null,stateFilterActive:!1,location:null},loadingPromise:null,loadingAddressAutocompletions:!1,loadingDealers:!1,tagfieldText:"",dealers:[],dealersDisplayed:[],cached:{},allItemsDisplayed:!0,refreshDealersAndUrlFragment:d,displayMoreItems:it};n.findADealer.searchOptions=v(s());n.$watch("findADealer.searchOptions.stateFilter",function(){n.findADealer.searchOptions.stateFilterActive=!0;n.findADealer.searchOptions.location&&(n.findADealer.searchOptions.tagfieldTags=[],n.findADealer.searchOptions.location=null);n.findADealer.refreshDealersAndUrlFragment()});n.$watch("findADealer.searchOptions.location",function(){n.findADealer.searchOptions.location&&(n.findADealer.searchOptions.stateFilterActive=!1)});$(window).on("hashchange",function(){t(function(){var t=s(),i=a(n.findADealer.searchOptions);t!==i&&(n.findADealer.searchOptions=v(s()),n.findADealer.refreshDealersAndUrlFragment())})})}function s(){var n=window.location.href.split("#")[1];return n?window.decodeURIComponent(n):null}function p(n,t){var i=window.location.href.split("#")[0],r=window.encodeURIComponent(n);t?window.history.replaceState({},null,i+"#"+r):window.history.pushState({},null,i+"#"+r)}function a(n){return n.stateFilterActive&&n.stateFilter?n.stateFilter:n.location?"location":"none"}function v(n){return!n||n==="none"?{stateFilterActive:!0,stateFilter:null,location:null,tagfieldTags:[]}:n.match(/location/)?{stateFilterActive:!0,stateFilter:null,location:null,tagfieldTags:[]}:{stateFilterActive:!0,stateFilter:n,location:null,tagfieldTags:[]}}function w(){return n.findADealer.searchOptions.stateFilterActive?n.findADealer.searchOptions.stateFilter:null}function b(n,t){return n?" for "+n:t?" for "+(t.suburb+", "+t.postcode+" "+t.state).replace(/ /g," "):""}function k(){var t=a(n.findADealer.searchOptions),i=s();t!==i&&p(t)}function d(){var t,i,r;if(n.findADealer.dealers=[],n.findADealer.dealersDisplayed=[],n.findADealer.showOnboarding=!1,n.findADealer.loadingPromise&&n.findADealer.loadingPromise.cancel(),t=f("formatArgs")(ToyotaConsts.API.Info.DealersByState,[n.findADealer.searchOptions.stateFilter]),n.findADealer.searchOptions.location&&(t=f("formatArgs")(ToyotaConsts.API.Info.Dealers,[n.findADealer.searchOptions.location.postcode,n.findADealer.searchOptions.location.suburb])),!n.findADealer.searchOptions.stateFilter&&!n.findADealer.searchOptions.location){h([],!0);return}if(k(),i=n.findADealer.cached[t],i){h(i,!1);return}n.findADealer.loadingDealers=!0;n.findADealer.showDealersCount=!1;r=o.get(t);n.findADealer.loadingPromise=r;r.then(function(i){if(i&&i.data&&i.data.results.length>0){n.findADealer.cached[t]=nt(i.data.results);h(n.findADealer.cached[t],!1);return}i&&i.data&&!i.data.results.length&&h([],!1)},function(){}).finally(function(){n.findADealer.loadingDealers=!1;n.findADealer.showDealersCount=!0})}function g(n){var t=["fleet","new","parts","service","used"];return n.filter(function(n){return t.indexOf(n.toLowerCase())>=0})}function h(i,r){function u(){n.findADealer.dealers=i;var t=i.length,u=Math.min(t,l);n.findADealer.showEmpty=t===0&&!r;n.findADealer.showOnboarding=r;n.findADealer.showDealersCount=!r;n.findADealer.dealersDisplayed=i.slice(0,u);n.findADealer.allItemsDisplayed=t<=l;n.findADealer.showDealersCount&&(n.findADealer.dealersCountDisplayed=t,n.findADealer.filterFriendlySummary=b(w(),n.findADealer.searchOptions.location))}if(i=i.slice(0),angular.element("html").hasClass("async-hide"))var f=window.setInterval(function(){angular.element("html").hasClass("async-hide")||(t(u(i)),window.clearInterval(f))},500);else t(u)}function nt(n){return n.map(function(n){return angular.extend({services:g(n.serviceTypes).join(", "),serviceImages:tt(n.serviceTypes),addressUrl:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(n.name+", "+n.address+", "+n.city+" "+n.state+", "+n.postCode),telephoneUrl:"tel://"+n.telephone.replace(/\s/g,"")},n)}).sort(function(n,t){var i=n.city.toLowerCase(),r=t.city.toLowerCase();return i<r?-1:i>r?1:0})}function tt(n){return[{expressmaintenance:"Express Maintenance"},{fivestardealer:"5 Star Dealer"},{fleetspecialistdealer:"Fleet Specialist Dealer"}].reduce(function(t,i){var r=Object.keys(i)[0];return t[r]=n.indexOf(i[r])>=0,t},{})}function it(){var i=n.findADealer.dealers.length,r=n.findADealer.dealersDisplayed.length+l,f=Math.min(i,r),u=$("html");u.css("overflow-anchor","none");n.findADealer.dealersDisplayed=n.findADealer.dealers.slice(0,f);i<=r&&(n.findADealer.allItemsDisplayed=!0);t(function(){u.css("overflow-anchor","")})}var c=this,l=12;c.loadTags=function(t){var r,f;return(n.findADealer.queryLength=t.length,t.length===0&&n.findADealer.searchOptions.tagfieldTags.length===0&&(n.findADealer.loadingAddressAutocompletions=!1),t.length<3)?(r=u.defer(),r.resolve([]),r.promise):(n.findADealer.loadingAddressAutocompletions=!0,f=i.maxResults,e(t,f).then(function(t){return n.findADealer.loadingAddressAutocompletions=!1,n.findADealer.autocompleteItemCount=t.length,t}))};c.setLocation=function(t){n.findADealer.searchOptions.tagfieldTags=[t];n.findADealer.searchOptions.stateFilterActive=!1;n.findADealer.searchOptions.location={postcode:t.tagInfo.postCode,suburb:t.tagInfo.suburb,state:t.tagInfo.state};n.findADealer.refreshDealersAndUrlFragment();n.findADealer.tagfieldText=""};c.removeLocation=function(){n.findADealer.searchOptions.tagfieldTags=[];n.findADealer.searchOptions.stateFilterActive=!0;n.findADealer.searchOptions.location=null;n.findADealer.refreshDealersAndUrlFragment()};c.$onInit=y}],r=function(){};return{scope:!1,restrict:"A",controller:i,controllerAs:"findADealerController",link:r}}]);angular.module("Toyota.Directives").directive("tyPressListing",[function(){var n=["$scope","$http","$filter","$timeout","$window","$interval","$analytics","API","$attrs",function(n,t,i,r,u,f,e,o,s){function y(){h.items=[];h.prescrollToItemIndex=parseInt(window.location.hash.substring(1));b().then(function(){c.currentItems.Remaining>0&&w().then(function(){isNaN(h.prescrollToItemIndex)||a(h.prescrollToItemIndex)})})}function b(){return p(i("formatArgs")(l.url,v)).then(function(n){h.items=n;c.currentItems=n})}function p(n){return h.busy=!0,k(),(c.apiCall=o.get(n)).then(function(n){if(angular.isDefined(n))return h.busy=!1,n.data})}function k(){return c.apiCall&&c.apiCall.cancel()}function w(){return v.pageNumber+=1,p(i("formatArgs")(l.url,v)).then(function(n){c.prefetchItems=n})}function a(n){if(!isNaN(n)&&c.currentItems.Data.length>n){g(n);return}c.currentItems.Remaining<=0||(d(),w().then(function(){isNaN(n)||a(n)}))}function d(){var n=c.currentItems.Data.concat(c.prefetchItems.Data);c.currentItems=c.prefetchItems;c.currentItems.Data=n;h.items=c.currentItems}function g(n){"scrollRestoration"in history&&(history.scrollRestoration="manual");var t=$(".ty-press-listing-results__result:eq("+n+")");$("html, body").scrollTop(t.offset().top)}function nt(n,t){var i=$(n).text();e.eventTrack("selectedNews",{eventType:"click",category:"link",label:i+":"+t.Title})}function tt(){e.eventTrack("showMoreNewsItems",{eventType:"click",category:"Lazy Loading",label:""})}var h=this;h.category="all";h.busy=!0;var c={currentItems:[],prefetchItems:[],apiCall:null,broadcast:!1},l={url:ToyotaConsts.API.News.PressListings,pageNumber:1,category:h.category},v={pageNumber:l.pageNumber,category:l.category,currentPage:s.currentSiteName,siteId:s.siteId};y();h.getMoreItems=function(){if(h.items.Remaining===0){h.busy=!0;return}tt();a()};h.getInitialItems=function(){y()};h.onItemClick=function(n,t){nt(n.currentTarget,t);window.location.hash=h.items.Data.indexOf(t)}}],t=function(){};return{scope:!0,restrict:"AE",replace:"true",controller:n,controllerAs:"plc",link:t,bindToController:!0}}]);angular.module("Toyota.Directives").directive("tyGradeSelectorItem",function(){var n=["$scope","$timeout","$rootScope","$element","$window",function(n){function i(){n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{};n.driveawayPrice.materialCode=t.materialCode;t.defaultTray!==""&&(n.driveawayPrice.accessoryCodes=[t.defaultTray])}var t=this;this.$onInit=i}];return{scope:!0,restrict:"A",controller:n,bindToController:{gradeId:"@gradeId",materialCode:"@materialCode",defaultTray:"@defaultTray"},controllerAs:"ctl",link:function(){}}});angular.module("Toyota.Directives").directive("tyGradeSelector",["Range",function(n){var t=["$scope","$rootScope","$element","$window","$analytics",function(t,i,r,u,f){function c(){h=n.getGradesList().reduce(function(n,t){return n||t.containsOptionPacks},!1);o=v()}function l(n){f.eventTrack("selectGrade",{eventType:"click",category:n.find(".ty-grade-selector-item__name").text().replace(/^\s+|\s+$/g,"")})}function a(n){f.eventTrack("selectGrade",{eventType:"passive",category:n.find(".ty-grade-selector-item__name").text().replace(/^\s+|\s+$/g,"")})}function v(){var t=n.getGradesList().find(function(n){return n.hasSpecialOffers&&!!n.vehicleModel.Title&&!!n.vehicleModel.Name});return t?{hasSpecialOffers:!0,vehicleModel:{title:t.vehicleModel.Title,query:t.vehicleModel.Name}}:{hasSpecialOffers:!1,vehicleModel:{}}}function s(t){var i,r,u;(t.addClass("selected"),i=t.attr("data-grade-id"),i)&&(r=n.getGradesList().find(function(n){return n.gradeId===i}),u={id:i,name:r.name,baseVariantId:r.baseVariantId,containsRoofPaints:r.containsRoofPaints,containsOptionPacks:h,hasSpecialOffers:o.hasSpecialOffers,vehicleModel:o.vehicleModel},y(u))}function y(n){i.$broadcast("grade-changed",{grade:n,source:"grade"})}var e=this,h,o;e.$onInit=c;e.setInitialGrade=function(){var n=r.find("[data-ty-grade-selector-item]:first");a(n);t.selectedItem=n;s(t.selectedItem)};t.$on("pricingpage-on-link-trigger",function(){e.setInitialGrade()});t.gradeSelectorItemClick=function(n){var i=$(n.target).closest("[data-ty-grade-selector-item]");i.length>0&&!i.hasClass("selected")&&(l(i),t.selectedItem.removeClass("selected"),i.addClass("selected"),t.selectedItem=i,s(t.selectedItem))}}],i=function(){};return{scope:!0,restrict:"A",controller:t,controllerAs:"tyGradeSelectorController",link:i}}]);angular.module("Toyota.Directives").directive("tyOptionPackSelector",["ToastManager",function(n){function t(n){return n.find(".ty-option-pack-selector__checkbox")}var i=["$scope","$element","$analytics","$rootScope","$filter","Range",function(i,r,u,f,e,o){function v(){i.savedOption=null}function y(){var r=s().filter(function(n,t){var r=angular.fromJson($(t).data("variant-ids"));return e("arrayIntersect")(r,i.variantIds).length>0}),t=s().not(r),u=t.filter(":checked").length;n.removeToastsByGroup("option-pack-unavailable");u&&(n.triggerBriefToast("Your selected additional extras are unavailable on current configuration.","option-pack-unavailable"),a(null));s().prop("disabled",!1);t.prop("disabled",!0).prop("checked",!1);p()}function c(n,t,i){var r=n.parent(".ty-option-pack-selector-item"),u=r.find(".ty-option-pack-selector-item__disabled-reason"),f=r.find(".ty-option-pack-selector-item__link"),e;if(t){f.css("display","");u.css("display","none");return}e=!t&&!!i;f.css("display","none");u.css("display",e?"":"none").text(i)}function p(){var t=o.getVariantsByGradeId(i.eventData.grade.id).map(function(n){return n.id}),n=s(),u=n.filter(function(n,i){return e("arrayIntersect")(t,$(i).data("variant-ids")).length===0}),f=n.filter(":disabled").filter(function(n,i){return e("arrayIntersect")(t,$(i).data("variant-ids")).length>0}),h=n.not(u).not(f);u.each(function(){c($(this),!1,r.data("grade-message")+" "+i.eventData.grade.name)});f.each(function(){c($(this),!1,r.data("variant-message"))});h.each(function(){c($(this),!0)})}function w(){var t=k(),n;t.length&&(n=t.filter('[data-option="'+i.savedOption+'"]'),n.prop("checked")||(n.prop("checked",!0),a(n.attr("data-option"))),t.not(n).prop("checked",!1))}function b(n,t){f.$broadcast("option-pack-changed",{grade:i.eventData.grade,variantIds:n,accessoryCode:i.eventData.accessoryCode,source:t})}function l(){return s().filter(":checked")}function k(){return s().filter(":not(:disabled)")}function s(){return t(r)}function d(n){u.eventTrack("selectOptionPack",{eventType:"click",category:n||"none"})}function a(n){u.eventTrack("selectOptionPack",{eventType:"passive",category:n||"none"})}var h=this;i.$on("variant-changed",function(n,t){(!t.grade||t.grade.containsOptionPacks)&&(i.eventData=t,i.variantIds=t.variantIds,y(),w(),h.updateVariantIds(t.source))});h.updateVariantIds=function(n){var t=angular.copy(i.variantIds),o=s(),u=l(),f,r;u.length===1?(f=u.data("variant-ids"),t=e("arrayIntersect")(t,f)):(r=[],o.each(function(){var n=$(this);r=r.concat(n.data("variant-ids"))}),t=e("arraySubtract")(t,r));b(t,n)};h.saveUserSelection=function(){var n=l(),t=n.length?n.attr("data-option"):null;i.savedOption=t;d(t)};h.$onInit=v}],r=function(i,r){function e(){return t(r)}var u=i.tyOptionPackSelectorController,f=e();f.on("change",function(t){var i=$(t.target);f.not(i).prop("checked",!1);u.saveUserSelection();u.updateVariantIds("variant");n.removeToastsByGroup("option-pack-unavailable")})};return{scope:!0,restrict:"A",controller:i,controllerAs:"tyOptionPackSelectorController",link:r}}]);angular.module("Toyota.Directives").directive("tyPaintSelector",["CssMediaWatcher","$timeout",function(n,t){var i=["$scope","$element","$analytics","$filter","$q","$rootScope","Range","Animations","PaintListColourMatcher",function(n,i,r,u,f,e,o,s,h){function d(){var f,r;n.paint={bodyPaints:[],roofPaints:[],roofPaintsDisplay:[],selectedBodyPaintID:"",selectedBodyPaintName:"",selectedBodyPaintNameDisplay:"",selectedBodyPaintHex:"",savedBodyPaintName:"",savedBodyPaintHex:"",selectedRoofPaintName:"",selectedRoofPaintNameDisplay:"",selectedRoofPaintID:"",containsRoofPaints:!1,containedRoofPaints:!1,loadingTimeout:null,source:"body-paint",sourceChanged:!1,eventData:{}};s.hide(a);n.$watch("paint.selectedBodyPaintID",function(){n.paint.source="body-paint";n.paint.sourceChanged=!0;y()});n.$watch("paint.selectedRoofPaintID",function(){if(p(),n.paint.source=n.paint.sourceChanged?n.paint.source:"roof-paint",n.paint.sourceChanged=!1,n.paint.selectedRoofPaintID!=""){var i=l(n.paint.selectedBodyPaintID),t=u("arrayFind")(i.RoofOptions,function(t){return t.ID==n.paint.selectedRoofPaintID});n.paint.selectedRoofPaintName=t.RoofPaintDescription;ht(t.MaterialCode,t.ID)}});n.$watch("paint.roofPaints",function(){function i(){var t=l(n.paint.selectedBodyPaintID);t&&(n.paint.selectedBodyPaintName=t.BodyPaintDescription,n.paint.selectedBodyPaintHex=t.BodySwatchHex)}var r=n.element.find(".ty-paint-selector__roof-paint .ty-paint-selector__items");if(t.cancel(n.paint.loadingTimeout),n.paint.containsRoofPaints&&n.paint.source!="variant"||i(),!n.paint.containsRoofPaints&&!n.paint.containedRoofPaints||n.paint.source=="variant"){n.paint.roofPaintsDisplay=n.paint.roofPaints.slice(0);n.updateFillerSwatches(b,n.paint.roofPaintsDisplay.length);return}n.paint.loadingTimeout=t(function(){n.paint.containsRoofPaints&&i();n.paint.roofPaintsDisplay=n.paint.roofPaints.slice(0);n.updateFillerSwatches(b,n.paint.roofPaintsDisplay.length);r.removeClass("ty-paint-selector__items--transitioning")},400);r.addClass("ty-paint-selector__items--transitioning")});f=i.find(".ty-paint-selector__body-paint .ty-paint-selector__option-description");n.$watch("paint.selectedBodyPaintName",function(){f.fadeOut(function(){t(function(){n.paint.selectedBodyPaintNameDisplay=n.paint.selectedBodyPaintName;f.fadeIn()})})});r=i.find(".ty-paint-selector__roof-paint .ty-paint-selector__option-description");n.$watch("paint.selectedRoofPaintName",function(){(n.paint.selectedBodyPaintName!==n.paint.selectedRoofPaintName||n.paint.selectedRoofPaintNameDisplay!==k)&&(n.paint.selectedBodyPaintName===n.paint.selectedRoofPaintName?r.fadeOut(function(){t(function(){n.paint.selectedRoofPaintNameDisplay=k;r.fadeIn()})}):r.fadeOut(function(){t(function(){n.paint.selectedRoofPaintNameDisplay=n.paint.selectedRoofPaintName;r.fadeIn()})}))});n.$on("variant-changed",function(n,t){!t.grade||t.grade.containsOptionPacks||v(t)});n.$on("option-pack-changed",function(n,t){!!t.grade&&t.grade.containsOptionPacks&&v(t)})}function v(t){p();ct();t.source=="grade"&&(t.grade.containsRoofPaints?s.slideThenFadeIn(a):s.fadeThenSlideOut(a));n.paint.source=t.source;n.paint.sourceChanged=!0;n.paint.containedRoofPaints=n.paint.containsRoofPaints;n.paint.containsRoofPaints=t.containsRoofPaints;n.paint.eventData=t;g();f.all(nt(t.variantIds)).then(function(t){var i=n.paint.eventData.variantIds.every(function(n,i){return n===t[i]});i&&(tt(),it(),y())})}function g(){n.paint.rawPaints=[]}function nt(t){return t.map(function(t){var i=f.defer();return o.getTrimsByVariantId(t).then(function(r){var u=r.map(function(n){return o.getPaintsByTrimId(n.ID).then(function(n){return n})});f.all(u).then(function(r){r.forEach(function(t){if(t.length){var i=o.getTrimIdByPaintId(t[0].ID),r=o.getVariantIdByTrimId(i);n.paint.eventData.variantIds.includes(r)&&(n.paint.rawPaints=n.paint.rawPaints.concat(t))}});i.resolve(t)})}),i.promise})}function tt(){n.paint.bodyPaints=[];angular.forEach(n.paint.rawPaints,function(t){var i,r,f;t.BodyPaintDescription&&(i=u("arrayFind")(n.paint.bodyPaints,function(n){return n.BodyPaintDescription==t.BodyPaintDescription}),i||(i={BodyPaintId:"body-paint-"+(t.BodyPaintDescription||"").replace(/[^A-Za-z0-9-]+/,"-"),BodyPaintDescription:t.BodyPaintDescription,BodySwatchHex:t.BodySwatchHex,BodySwatchImage:t.BodySwatchImage,RoofOptions:[]},n.paint.bodyPaints.push(i)),r={ID:t.ID,MaterialCode:t.MaterialCode,RoofPaintDescription:t.RoofPaintDescription,RoofPaintSwatchImage:t.RoofSwatchImage},r.RoofPaintDescription==null&&(r.RoofPaintDescription=t.BodyPaintDescription,r.RoofPaintSwatchImage=t.BodySwatchImage),f=u("arrayFind")(i.RoofOptions,function(n){return n.RoofPaintDescription==r.RoofPaintDescription}),f||i.RoofOptions.push(r))});n.updateFillerSwatches(vt,n.paint.bodyPaints.length)}function y(){if(n.paint.selectedBodyPaintID!==""){var t=l(n.paint.selectedBodyPaintID);st(t)}}function it(){var i=n.paint.selectedBodyPaintID,t=rt();t&&(n.paint.selectedBodyPaintID=t.BodyPaintId,n.paint.selectedBodyPaintID!==i&&ft(n.paint.selectedBodyPaintID))}function rt(){var t=h({colourTuples:n.paint.bodyPaints.map(function(n){return{description:n.BodyPaintDescription,hex:n.BodySwatchHex}})}).closestMatch({description:n.paint.savedBodyPaintName||n.paint.selectedBodyPaintName,hex:n.paint.savedBodyPaintHex||n.paint.selectedBodyPaintHex},.8),i;return t&&(i=u("arrayFind")(n.paint.bodyPaints,function(n){return n.BodyPaintDescription==t.description})),i||n.paint.bodyPaints[0]}function ut(n){var t=l(n);r.eventTrack("selectBodyPaint",{eventType:"click",category:t.BodyPaintDescription})}function ft(n){var t=l(n);r.eventTrack("selectBodyPaint",{eventType:"passive",category:t.BodyPaintDescription})}function et(i){var f=l(n.paint.selectedBodyPaintID).BodyPaintDescription,r=u("arrayFind")(i.RoofOptions,function(t){return t.RoofPaintDescription==n.paint.selectedRoofPaintName});r=r||u("arrayFind")(i.RoofOptions,function(n){return n.RoofPaintDescription==f});r=r||i.RoofOptions[0];r&&t(function(){n.paint.selectedRoofPaintID=r.ID})}function ot(){t(function(){var t=n.element.find("input:checked + label"),i=n.element.find(".ty-paint-selector__items-outer"),r=t.position().left,u=t.outerWidth(!0),f=i.width();i.scrollLeft(r+u-f)},0,!1)}function l(t){return u("arrayFind")(n.paint.bodyPaints,function(n){return n.BodyPaintId==t})}function st(t){et(t);n.paint.roofPaints=t.RoofOptions}function ht(t,i){c.resolve({grade:n.paint.eventData.grade,materialCode:t,accessoryCode:n.paint.eventData.accessoryCode,paintCode:i,source:n.paint.source})}function p(){!c||c.promise.done||c.reject("paint selection changed");c=f.defer();var n=c.promise;n.done=!1;n.then(function(){n.done=!0;lt()});e.$broadcast("paint-changed",c.promise)}function ct(){i.addClass("-is-loading")}function lt(){i.removeClass("-is-loading")}var w=this,at=i.find(".ty-paint-selector__body-paint"),vt=at.find(".ty-paint-selector__items"),a=i.find(".ty-paint-selector__roof-paint"),b=a.find(".ty-paint-selector__items"),c,k="Standard";w.saveBodyPaint=function(){n.paint.savedBodyPaintName=n.paint.selectedBodyPaintName;n.paint.savedBodyPaintHex=n.paint.selectedBodyPaintHex;ut(n.paint.selectedBodyPaintID)};n.$on("ng-repeat-finished",function(n,t){t==="body-paint"&&ot()});n.paintOrderingComparator=function(t,i){var r=n.paint.ordering.indexOf(t.value),u=n.paint.ordering.indexOf(i.value);return r===-1&&u===-1?t.value<i.value?-1:1:u===-1?-1:r===-1?1:r<u?-1:1};n.roofPaintOrderingComparator=function(t,i){return t.value==n.paint.selectedBodyPaintName?-1:i.value==n.paint.selectedBodyPaintName?1:n.paintOrderingComparator(t,i)};w.$onInit=d}],r=function(t,i,r){t.paint.ordering=angular.fromJson(r.paintOrdering);t.element=i;var e=i.find(".ty-paint-selector__items"),o=n({$el:i,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}),u=function(n){return n.find(".ty-paint-selector-item:not(.ty-paint-selector-item--filler)")},s=function(n){return n.find(".ty-paint-selector-item.ty-paint-selector-item--filler")},f=function(n,t){var r=s(n),i=r.length,u,f,e;i>t?(u=i-t,r.slice(0,u).remove()):i<t&&(f=t-i,e="<label class='ty-paint-selector-item ty-paint-selector-item--filler'><\/label>".repeat(f),n.append(e))},h=function(){e.each(function(n,i){var r=$(i),f=u(r),e=f.length;t.updateFillerSwatches(r,e)})};t.updateFillerSwatches=function(n,t){var e=o.getCurrentMedia().viewportWidth;if(!e.is.mobile){f(n,0);return}var s=u(n),i=Math.floor(n.width()/s.outerWidth(!0)),h=Math.ceil(t/i),c=i*h,r=c-t;Number.isInteger(r)&&f(n,r)};$(window).on("scroll resize orientationChange load",h)};return{scope:!0,restrict:"A",controller:i,controllerAs:"tyPaintSelectorController",link:r}}]);angular.module("Toyota.Directives").directive("tyPricingCta",function(){var n=["$scope","$element","$timeout",function(n,t,i){function e(){n.dealerInventory=n.dealerInventory?n.dealerInventory:{}}function r(){f.addClass("-is-loading")}function u(){f.removeClass("-is-loading")}var o=this,f=t.find(".vehicle-pricing-cta__loading-spinner");n.$on("vehicle-pricing-material-code",function(t,f){r();f.then(function(){i(function(){n.dealerInventory.loading||u()},200)})});n.$watch("dealerInventory.loading",function(){n.dealerInventory.loading?r():u()});this.$onInit=e}];return{scope:!1,restrict:"A",controller:n,bindToController:!0,controllerAs:"pricingCtaController",link:function(){}}});angular.module("Toyota.Directives").directive("tyPricingDriveaway",function(){var n=["$scope","$element",function(n,t){function i(){}var u=this,r;n.pricingDriveaway=n.pricingDriveaway?n.pricingDriveaway:{};n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{};r=t.find(".vehicle-pricing-driveaway__loading-spinner");n.$on("vehicle-pricing-material-code",function(t,i){i.then(function(t){n.driveawayPrice.materialCode=t.materialCode;n.driveawayPrice.accessoryCodes=t.accessoryCodes})});n.pricingDriveaway.loading=function(){return n.driveawayPrice.loading||n.pricingPage.loading};n.pricingDriveaway.showPrice=function(){return!(n.driveawayPrice.price===0||n.driveawayPrice.price==="0")};this.$onInit=i}];return{scope:!1,restrict:"A",controller:n,bindToController:!0,controllerAs:"pricingDriveawayController",link:function(){}}});angular.module("Toyota.Directives").directive("tyPricingImage",function(){var n=["$scope","$element","$filter","API","$timeout",function(n,t,i,r,u){function c(){n.pricingImage.loading=!0;s.addClass("-is-loading")}function f(){n.pricingImage.loading=!1;s.removeClass("-is-loading")}var e=this,o=null,s=t.find(".vehicle-pricing__loading-spinner"),h=t.find("img"),l=function(){n.pricingImage=n.pricingImage?n.pricingImage:{};n.pricingImage.showImage=!1;n.pricingImage.loading=!1;n.pricingImage.materialCode=""};e.$onInit=l;n.$on("vehicle-pricing-material-code",function(t,i){c();i.then(function(){n.pricingImage.materialCode!==n.materialCode&&(n.pricingImage.materialCode=n.materialCode,e.updateImage())})});e.updateImage=function(){if(n.pricingImage.materialCode){var t=i("formatArgs")(ToyotaConsts.API.Vehicle.Image,[n.pricingImage.materialCode]);r.cancel(o);h.off("load error");o=r.get(i("formatArgs")(ToyotaConsts.API.Vehicle.Image,[n.pricingImage.materialCode]));o.then(function(t){var r,o,e;if(t&&t.data)if(r=[],o=/^(\d+)x(\d+)$/,t.data.success)if(angular.forEach(t.data.images,function(n){var t=n.resolution.match(o),u=t[1],f=t[2];r.push(i("formatArgs")("{0} {1}w",[n.url,u]))}),n.pricingImage.showImage=!0,e=r.join(", "),n.image.srcset===e)f();else{n.image.srcset=e;h.one("load error",function(){f();n.$apply()});u(function(){window.picturefill({reevaluate:!0})})}else n.pricingImage.showImage=!1,f()},function(){n.pricingImage.showImage=!1;f()})}}}];return{scope:!1,restrict:"A",controller:n,bindToController:!0,controllerAs:"pricingImageController",link:function(n){n.image={};n.pricingImageController.updateImage()}}});angular.module("Toyota.Directives").directive("tyPricingPage",["CssMediaWatcher",function(n){var t=["$scope","$timeout","$rootScope","$element","$window","$filter","API","$q","Range","$attrs",function(n,t,i,r,u,f,e,o,s,h){function v(){var n=angular.fromJson(h.variantObject),t=angular.fromJson(h.gradeObject);s.setVariantOptions(n);s.setGradesList(t)}function l(){a.addClass("-is-loading")}function y(){a.removeClass("-is-loading")}function p(){!c||c.promise.done||c.reject("material code changed");c=o.defer();var t=c.promise;t.done=!1;t.then(function(){t.done=!0});n.$broadcast("vehicle-pricing-material-code",c.promise)}function w(t,i){t&&(n.materialCode=t,c.resolve({materialCode:n.materialCode,accessoryCodes:typeof i!="undefined"&&i!=null?[i]:null}))}function b(t,i){n.$broadcast("vehicle-model-changed",{hasSpecialOffers:t,vehicleModel:i})}var k=this,c,a=r.find(".vehicle-pricing-info__loading-spinner");n.pricingPage={loading:!1};n.$on("paint-changed",function(t,i){p();l();n.pricingPage.loading=!0;i.then(function(t){n.pricingPage.loading=!1;w(t.materialCode,t.accessoryCode);b(t.grade.hasSpecialOffers,t.grade.vehicleModel)})});n.$watchGroup(["driveawayPrice.loading","pricingImage.loading","dealerInventory.loading"],function(){n.driveawayPrice.loading||n.pricingImage.loading||n.dealerInventory.loading||n.pricingPage.loading?l():y()});k.$onInit=v}],i=function(t,i){t.$broadcast("pricingpage-on-link-trigger",{});var r=i.find(".vehicle-pricing-info"),f=i.find(".vehicle-pricing__select"),e=66,s=n({$el:i,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}),l=function(){var t=f[0].getBoundingClientRect().top,i=f[0].getBoundingClientRect().bottom,n=f.outerHeight()-r.outerHeight(),u=n>0?n:0,o=s.getCurrentMedia().viewportWidth;t>e||o.is.mobile?r.css("margin-top","").css("position","").css("top",""):i<r.outerHeight()+e?r.css("margin-top",u).css("position","").css("top",""):r.css("margin-top","").css("position","fixed").css("top",e)},h=i.find(".vehicle-pricing-driveaway-main"),u=i.find(".vehicle-pricing-sticky-footer"),c=u.outerHeight(),a=function(){var n=i[0].getBoundingClientRect().top,t=window.innerHeight-n,r=(h[0].getBoundingClientRect().top+h[0].getBoundingClientRect().bottom)/2,f=window.innerHeight-r,e=s.getCurrentMedia().viewportWidth;e.is.mobile?t>c&&f<c/2?u.slideDown():u.slideUp():u.hide()},o=function(){l();a()};o();t.$on("secondary-nav-repaint",o);$(window).on("scroll resize orientationChange load",o)};return{scope:!0,restrict:"A",controller:t,controllerAs:"ctl",link:i}}]);angular.module("Toyota.Directives").directive("tyPricingSpecialOffers",function(){var n=["$scope","$element","$attrs","$filter","API","RangePaint","Animations",function(n,t,i,r,u,f,e){function o(){var i={};n.vehicleModel="";n.urlVehicleModel="";e.hide(t);n.$on("vehicle-model-changed",function(r,u){i=u.vehicleModel;!u.hasSpecialOffers||!i.title||!i.query?e.fadeThenSlideOut(t):(n.vehicleModel=i.title,n.urlVehicleModel=i.query.toLowerCase(),e.slideThenFadeIn(t))})}var s=this;s.$onInit=o}];return{scope:!1,restrict:"A",controller:n,bindToController:!0,controllerAs:"pricingSpecialOffersController",link:function(){}}});angular.module("Toyota.Directives").directive("tyVariantSelector",function(){var n=["$scope","$element","$analytics","$rootScope","$filter","Animations","$timeout","Range",function(n,t,i,r,u,f,e,o){function it(){f.hide(c);n.savedOption={}}function rt(){var r=p(n.grade.id),o=k(),t=u("arrayFind")(r,function(n){return n.id===o[0]}),s=l,i;l=!!t.tray.Accessory_Code;n.trayOptionLabel=l?t.tray.Attribute_Value:n.trayOptionLabel;n.accessoryCode=t.tray.Accessory_Code;l?(f.slideThenFadeIn(c),s||(i=c.find(".ty-variant-selector__item"),e(function(){b(i)}))):f.fadeThenSlideOut(c)}function b(n){i.eventTrack("selectVariant",{eventType:"passive",category:$.trim(n.closest(".ty-variant-selector__items").prev().text()),label:$.trim(n.find(".ty-variant-selector__label-title").text())})}function a(n){if(!n.prop("checked")){var t=ht(n);b(t)}n.closest(".ty-variant-selector__items").find(".ty-variant-selector__item").prop("checked",!1);n.prop("checked",!0)}function ut(n){angular.forEach(s,function(t,i){var r=w(i,tt(i,n).option);r.length&&a(r)})}function k(){var n=[];return angular.forEach(s,function(t,i){n.push(d(i))}),v(n)}function v(t){var i,r;if(t.length===0)throw new Error("combineVariantIds requires an array containing at least one variantId array");return i=angular.copy(t),i=i.filter(function(n){return typeof n!="undefined"}),r=i[0],i.length>1&&angular.forEach(i,function(n){n instanceof Array&&(r=u("arrayIntersect")(r,n))}),ft(r,n.grade.id)}function d(n){return angular.fromJson(y(n).data("variant-ids"))}function y(n){return nt(n).filter(":checked")}function ft(n,t){var i=g(t);return n.filter(function(n){return i.indexOf(n)!==-1})}function p(n){return o.getVariantsByGradeId(n)}function g(n){return p(n).map(function(n){return n.id})}function nt(n){return t.find(s[n].optionSelector)}function et(){var t=[g(n.grade.id)];angular.forEach(s,function(n,i){var u=nt(i),f,e,o,r;st(u,t);f=y(i);f.length===0&&(e=ot(i),e||(o=v(t)[0],r=w(i,tt(i,o).option),r.length&&a(r)));u.length&&t.push(d(i))})}function ot(t){var r=y(t),i;return!!n.savedOption[t]&&(i=w(t,n.savedOption[t]),i.length&&!i.prop("disabled"))?(a(i),!0):!1}function st(n,t){var i=n.filter(function(n,i){var r=angular.fromJson($(i).data("variant-ids")),u=[r].concat(t);return v(u).length>0});n.prop("disabled",!1).not(i).prop("disabled",!0).prop("checked",!1)}function tt(n,t){var r=o.getVariantOptions()[s[n].variantOptionsKey],i=r.filter(function(n){var i=u("arrayFind")(n.variantIds,function(n){return n===t});return typeof i!="undefined"});return i.length>0?i[0]:null}function w(n,i){return t.find('[data-variant-type="'+n+'"][data-option="'+i+'"]')}function ht(n){return $('.ty-variant-selector__item[for="'+n.attr("id")+'"]')}function ct(t,i){r.$broadcast("variant-changed",{grade:n.grade,variantIds:t,accessoryCode:n.accessoryCode,source:i})}function lt(t){var i=at(t),r=Math.max.apply(null,i),u;return r===0?n.grade.baseVariantId:(u=i.indexOf(r),t[u].id)}function at(t){return t.map(function(t){var i=0;return Object.keys(n.savedOption).forEach(function(r){t[r]===n.savedOption[r]&&i++}),i})}var h=this,s={cabChassis:{optionSelector:".ty-variant-selector__items--cab-chassis .ty-variant-selector__radio",variantOptionsKey:"cabChassis"},cab:{optionSelector:".ty-variant-selector__items--cab .ty-variant-selector__radio",variantOptionsKey:"cabs"},drivetrain:{optionSelector:".ty-variant-selector__items--drivetrain .ty-variant-selector__radio",variantOptionsKey:"drivetrains"},chassis:{optionSelector:".ty-variant-selector__items--chassis .ty-variant-selector__radio",variantOptionsKey:"chassis"},transmission:{optionSelector:".ty-variant-selector__items--transmission .ty-variant-selector__radio",variantOptionsKey:"transmissions"},fuelType:{optionSelector:".ty-variant-selector__items--fuel-type .ty-variant-selector__radio",variantOptionsKey:"fuelTypes"},seatOption:{optionSelector:".ty-variant-selector__items--seat-option .ty-variant-selector__radio",variantOptionsKey:"seatOptions"}},c=t.find(".ty-variant-selector__option-category--tray"),l=!1;n.$on("grade-changed",function(t,i){n.grade=i.grade;h.updateVariantIds(i.source)});h.updateVariantIds=function(t){var u=p(n.grade.id),i,r;t==="grade"&&(i=lt(u),ut(i));et();rt();r=k();ct(r,t)};h.triggerBodyPaintActiveSelectionAnalyticsEvent=function(n){i.eventTrack("selectVariant",{eventType:"click",category:$.trim(n.closest(".ty-variant-selector__items").prev().text()),label:$.trim(n.find(".ty-variant-selector__label-title").text())})};h.$onInit=it}],t=function(n,t){t.find(".ty-variant-selector__items").each(function(t,i){var r=angular.element(i);r.find(".ty-variant-selector__radio").on("change",function(t){var i=$(t.target),r=i.data("variant-type"),u=i.data("option");n.savedOption[r]=u;n.tyVariantSelectorController.updateVariantIds("variant")});r.find(".ty-variant-selector__item").on("click",function(){$(this).prev().prop("disabled")||n.tyVariantSelectorController.triggerBodyPaintActiveSelectionAnalyticsEvent($(this))})})};return{scope:!0,restrict:"A",controller:n,controllerAs:"tyVariantSelectorController",link:t}});angular.module("Toyota.Directives").directive("tyRangePage",["CssMediaWatcher","MouseDetectionService",function(n,t){var i=["$scope","$element",function(n,t){function i(){var i=t.find(".owl-carousel");i.on("initialized.owl.carousel resized.owl.carousel",function(t){n.page=t.page})}var r=this;r.$onInit=i}],r=function(n,i){function u(){var i=window.getComputedStyle(h.get(0)).transform,f=i.match(/matrix\(.*,.*,.*,.*,(.*),.*\)/)||i.match(/matrix3d\(.*,.*,.*,.*,.*,.*,.*,.*,.*,.*,.*,.*,(.*),.*,.*,.*\)/),s=parseInt(f?f[1]:0,10);r.each(function(i,r){var u=$(r),c=u.data("owlItem"),l=u.data("gradeCardTimeline"),f=e(c,i,s),h;l.progress(f);u.attr("progress",f);t.mouseFound?(h=u.data("innerContainer"),u.addClass("ty-range-page-grade__mouse-detected"),n.page.size<=1?h.addClass("ty-range-page-grade__inner-container--fade-in"):o(h,f)):u.removeClass("ty-range-page-grade__mouse-detected")});window.requestAnimationFrame(u)}function e(t,i,u){var e;if(n.page.size<=1||(e=t.attr("style"),!e))return.5;var o=t.attr("style").match(/width: ([.0-9]+)px/),c=window.parseInt(o?o[1]:0,10),s=t.attr("style").match(/margin-right: ([0-9]+)px/),l=window.parseInt(s?s[1]:0,10),h=c+l,a=i*h+u,v=h*(n.page.size-1),f=Math.min(Math.max(a/v*.6+.2,0),1);return f>=.8&&i<n.page.size?f=.8:f<=.2&&i>=r.length-n.page.size&&(f=.2),f}function o(n,t){t>=.2-f&&t<=.8+f?n.addClass("ty-range-page-grade__inner-container--fade-in"):(t===0||t===1)&&n.removeClass("ty-range-page-grade__inner-container--fade-in")}var s=i.find(".owl-carousel"),h=i.find(".owl-stage"),r=i.find(".ty-range-page-grade"),f=.01;r.each(function(t,i){var r=$(i),u=new TimelineLite;u.pause();r.data("owlItem",r.closest(".owl-item"));r.data("innerContainer",r.find(".ty-range-page-grade__inner-container"));r.data("gradeCardTimeline",u);u.from(r,.2,{x:0,y:0,force3D:!0,opacity:0,ease:Power0.easeNone});u.to(r,.2,{x:0,y:0,force3D:!0,opacity:0,ease:Power0.easeNone},"0.8");r.on("click",function(){n.page.size===1&&n.page.index!==t&&s.trigger("to.owl.carousel",t)})});window.requestAnimationFrame(u)};return{scope:!0,restrict:"A",controller:i,controllerAs:"ctl",link:r}}]);angular.module("Toyota").directive("offerLanding",["$filter","$q","API","localstorage","Location","Region",function(n,t,i,r,u){var f=["$scope","$location","$element","$attrs","$rootScope","$window",function(n,t,i,r,f){function e(){n.$on("GeoPostCode",function(){n.currentRegion=n.GetRegion()});n.showHiddenCarTypes=!1;n.showHideButtonText="Show all";n.currentRegion=n.GetRegion();n.validOfferSequenceIDs=[];n.hideSpecialOffersPageBanner=!!t.search().model;n.hideBackToAllSpecialOffers=!t.search().model;n.bodyTypeHeading=t.search()["model-label"]?t.search()["model-label"]:"All"}var o=this;n.GetRegion=function(){return u.get().region};n.showAllByType=function(){n.showHideButtonText=n.showHiddenCarTypes?"Show all":"Show less";n.showHiddenCarTypes=!n.showHiddenCarTypes};n.route=function(n){t.path(n)};n.showHideToggle=function(t,i){var r=!1;return n.validOfferSequenceIDs.indexOf(t)>i-1&&(r=!0),n.showHiddenCarTypes&&(r=!1),r};n.inRegion=function(t,i){return n.currentRegion===null||n.currentRegion===""?i.reduce(function(n,t){return n||t.indexOf("ALL")>=0},!1):i.reduce(function(t,i){return t||i.indexOf(n.currentRegion)>=0||i.indexOf("ALL")>=0},!1)};n.matchModel=function(n){return"model"in t.search()?n.reduce(function(n,i){return n||i.toLowerCase()===t.search().model.toLowerCase()},!1):!0};n.sortNumber=function(n,t){return n-t};n.showOffer=function(t,i,r,u){var f=n.inRegion(t,r)&&n.matchModel(u),e;return f&&n.validOfferSequenceIDs.indexOf(t)<0?n.validOfferSequenceIDs.push(t):!f&&n.validOfferSequenceIDs.indexOf(t)>=0&&(e=n.validOfferSequenceIDs.indexOf(t)>=0,n.validOfferSequenceIDs.splice(e)),n.validOfferSequenceIDs.sort(n.sortNumber),!n.showHideToggle(t,i)&&f};n.onMouseOver=function(n){var t=$(n.currentTarget).find("img"),i=$(t).attr("srcset"),r=$(t).attr("data-hover-srcset"),u=$(t).attr("data-default-srcset");u==""&&$(t).attr("data-default-srcset",i);$(t).attr("srcset",r);console.log("---Mouse over")};n.onMouseLeave=function(n){var t=$(n.currentTarget).find("img"),i=$(t).attr("data-default-srcset");$(t).attr("srcset",i);console.log("Mouse--Leave")};n.showChangeLocationModal=function(){f.$broadcast("modal-open","change-location")};n.HaveLocationData=function(){return!!n.GetPostCode()};n.GetPostCode=function(){return u.get().postcode};n.GetSuburb=function(){return u.get().suburb};o.$onInit=e}],e=function(){};return{scope:!0,restrict:"A",controller:f,bindToController:!0,link:e}}]);angular.module("Toyota.Directives").directive("tyDriveawayPriceLocation",["$filter","API","localstorage",function(){var n=["$scope","$attrs","$rootScope",function(n,t,i){function r(){n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{}}var u=this;n.showChangeLocationModal=function(){i.$broadcast("modal-open","change-location")};this.$onInit=r}],t=function(n,t,i){n.driveawayPrice.materialCode=i.materialcode;n.materialCode=i.materialcode};return{scope:!0,restrict:"A",controller:n,controllerAs:"tyDriveawayPriceLocationController",bindToController:!0,link:t}}]);angular.module("Toyota.Directives").directive("tyTestDriveawayPrice",["$filter",function(){var n=["$scope",function(n){n.init=function(){n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{};n.driveawayPrice.materialCode="";n.driveawayPrice.accessoriesPrice=0};n.init()}];return{scope:!1,restrict:"A",controller:n,bindToController:!0,link:function(){}}}]);angular.module("Toyota.Directives").directive("tyColourSpinnerChr",["$window",function(n){return{scope:!1,link:function(t,i){function u(){return}var f=i.find("iframe"),r;$(n).on("message",function(n){if(n.originalEvent.source===f.get(0).contentWindow&&n.originalEvent.data.match(/^\{.*\}$/)){var i=JSON.parse(n.originalEvent.data);i.type==="update"&&(u("Window receiving ",i.type,i[i.type]),i.update.materialCode&&t.$apply(function(){t.driveawayPrice.materialCode=i.update.materialCode}))}});r={type:"requestUpdate",requestUpdate:{fields:["materialCode"]}};u("Window sending message",r.type,r[r.type]);f.get(0).contentWindow.postMessage(JSON.stringify(r),"*")}}}]);angular.module("Toyota.Directives").directive("tyHeroInfo",function(){var n=["$scope","$element",function(){function n(){}var t=this;n()}],t=function(n,t){t.next().is("[data-ty-fancy-accordion]")&&t.addClass("vehicle-info--fancy-accordion")};return{scope:!1,restrict:"A",controller:n,controllerAs:"ctl",link:t}});angular.module("Toyota.Directives").directive("tyOwlCarousel",["$rootScope","GlobalBreakpoints","CssMediaWatcher","ScrollLock","$analytics",function(n,t,i,r,u){var f=["$scope","$timeout","$element",function(){function n(){}var t=this;n()}],e=function(f,e){function b(t){if(tt(),g(),k(),nt(t),e.find("[data-ty-maintain-height-group]").length){var i=e.closest("[data-ty-maintain-height-id]").attr("data-ty-maintain-height-id");i&&n.$broadcast("force-maintain-height",i)}}function nt(n){y=n.item.count>n.page.size}function k(){l.css({top:o.anchorWrapperPreStickyTop});c.css({position:o.isSticky?"fixed":"",top:o.isSticky?o.stickyWrapperTop:""});s.css({top:p.getCurrentMedia().viewportWidth.is.navStickyActive&&o.isPostSticky?o.anchorWrapperPostStickyTop-o.anchorWrapperPreStickyTop:""});st=angular.copy(o)}function d(){var n=a.get(0).getBoundingClientRect(),t=v.get(0).getBoundingClientRect();return Math.max(n.bottom,t.bottom)-Math.min(n.top,t.top)}function g(){if(s.length){var i=d(),r=l.get(0).getBoundingClientRect(),u=document.body.clientHeight,t=r.top,n=u/2-i/2,f=t+(o.anchorWrapperPostStickyTop-o.anchorWrapperPreStickyTop);o.isPostSticky=f<=n;o.isSticky=t<=n&&!o.isPostSticky;o.stickyWrapperTop=n;o.isSticky&=p.getCurrentMedia().viewportWidth.is.navStickyActive}}function tt(){if(s.length){var a=f.navInitialPositionSourceSelector?e.find(f.navInitialPositionSourceSelector):h,v=f.navFinalPositionSourceSelector?e.find(f.navFinalPositionSourceSelector):h,i={top:0,middle:.5,bottom:1},y=e.find(".owl-carousel"),r=d(),n=a.get(0).getBoundingClientRect(),p=n.bottom-n.top,u=f.navInitialPositionAlign?i[f.navInitialPositionAlign]:.5,w=u*p-u*r,t=v.get(0).getBoundingClientRect(),b=t.bottom-t.top,c=f.navFinalPositionAlign?i[f.navFinalPositionAlign]:.5,k=c*b-c*r,l=y.get(0).getBoundingClientRect();o.anchorWrapperPreStickyTop=n.top+w-l.top;o.anchorWrapperPostStickyTop=t.top+k-l.top}}function it(n,t){u.eventTrack("owlCarousel",{eventType:"itemChange",category:f.analyticsId?f.analyticsId:"owlCarousel",direction:n,itemIndex:t})}function rt(n){var i=!1,t,r={items:1,loop:!1,nav:!1,mouseDrag:!1,touchDrag:function(){return!1},smartSpeed:750,dragEndSpeed:500,onInitialized:function(n){i=!0;ft();b(n)},onRefreshed:function(n){i&&b(n)},onDrag:function(){$(e).find(".owl-stage").addClass("owl-stage-drag-transition")},onTranslated:function(){$(e).find(".owl-stage").removeClass("owl-stage-drag-transition")},navText:f.navTextPrevSrc||f.navTextNextSrc?[$(f.navTextPrevSrc).html(),$(f.navTextNextSrc).html()]:undefined,onChanged:function(n){if(i&&t!==n.item.index){var r=n.item.index<t?"left":"right";t=n.item.index;it(r,t)}}},u;return angular.extend(r,n),u=$(f.stagePaddingSourceSelector),u.length&&(r.stagePadding=function(){var n=u.get(0).getBoundingClientRect(),t=n.right-n.left;return t===0?14:(document.body.clientWidth-t)/2}),r}function ut(){var n=e.closest(".ty-sc-owl-carousel");n.hasClass("ty-sc-owl-carousel--vehicle-info")&&n.next().is("[data-ty-fancy-accordion]")&&n.addClass("ty-sc-owl-carousel--fancy-accordion")}function ft(){h=h&&h.length?h:e.find(".owl-stage-outer");s=s&&s.length?s:e.find(".owl-nav");a=a&&a.length?a:e.find(".owl-prev");v=v&&v.length?v:e.find(".owl-next");c=c&&c.length?c:s.wrap('<div class="ty-owl-carousel-nav-sticky-wrapper"><\/div>').parent();l=l&&l.length?l:c.wrap('<div class="ty-owl-carousel-nav-anchor-wrapper"><\/div>').parent()}function et(){function o(){var n=l.scrollTop();u||(u=n);i.unshift(n);i.length>2&&i.pop();t=t||u!==n&&!r.isLocked}var n=w.data("owl.carousel"),s=n.onDragStart,h=n.onDragMove,c=n.onDragEnd,e=f.disableElasticDraggingOnItemOverflow==="true",t=!1,u=null,i=[],l=$("body");n.onDragStart=function(){t||(e?!y:0)||s.apply(this,arguments)};n.onDragMove=function(){o();t||(e?!y:0)||(i.length>1&&!r.isLocked&&r.lock(),h.apply(this,arguments))};n.onDragEnd=function(){u=null;i=[];t=!1;(e?y:!0)&&(r.isLocked&&r.unlock(),c.apply(this,arguments))}}function ot(){function n(){g();k()}var r=t.parseCompoundExpression(f.navStickyBreakpoints||"all");p=i({$el:angular.element(".ty-global-breakpoint-sensor"),pseudoEl:"before",breakpointRegexes:{navStickyActive:"^("+r.join("|")+")$"}});w=$(e).find(".js-owl-carousel");w.owlCarousel(rt(f.options));et();ut();$(window).on("scroll",n);$(window).on("resize",n)}var p,w,h,s,a,v,c,l,st={},o={anchorWrapperPreStickyTop:null,stickyWrapperTop:null,anchorWrapperPostStickyTop:null,isSticky:!1,isPostSticky:!1},y;ot()};return{scope:{navTextPrevSrc:"@?tyOwlCarouselNavPrevHtmlSrc",navTextNextSrc:"@?tyOwlCarouselNavNextHtmlSrc",options:"=?tyOwlCarouselConfig",stagePaddingSourceSelector:"@?tyOwlCarouselStagePaddingSourceSelector",navInitialPositionSourceSelector:"@?tyOwlCarouselNavInitialPositionSourceSelector",navInitialPositionAlign:"@?tyOwlCarouselNavInitialPositionAlign",navSticky:"@?tyOwlCarouselNavSticky",navStickyBreakpoints:"@?tyOwlCarouselNavStickyBreakpoints",navFinalPositionSourceSelector:"@?tyOwlCarouselNavFinalPositionSourceSelector",navFinalPositionAlign:"@?tyOwlCarouselNavFinalPositionAlign",disableElasticDraggingOnItemOverflow:"@?tyOwlCarouselDisableElasticDraggingOnItemOverflow",analyticsId:"@?tyOwlCarouselAnalyticsId"},restrict:"A",controller:f,controllerAs:"ctl",template:'<div class="owl-carousel js-owl-carousel"><div data-ng-transclude-replace><\/div><\/div>',transclude:!0,link:e}}]);angular.module("Toyota.Directives").directive("tyRangeModel",function(){var n=["$scope","$timeout","$rootScope",function(n,t,i){function r(){n.driveawayPrice=n.driveawayPrice?n.driveawayPrice:{};n.driveawayPrice.materialCode=u.initialMaterialCode;n.driveawayPrice.accessoriesPrice=0}var u=this;n.showChangeLocationModal=function(){i.$broadcast("modal-open","change-location")};this.$onInit=r}],t=function(){};return{scope:!0,restrict:"A",controller:n,bindToController:{initialMaterialCode:"@tyRangeModelInitialMaterialCode"},controllerAs:"ctl",link:t}});angular.module("Toyota.Directives").directive("tySecondaryNav",["$window","Location","CssMediaWatcher","InfoService","$timeout",function(n,t,i,r,u){var f=800,e=["$scope","$rootScope",function(n,t){n.showLocationOverlay=function(){t.$broadcast("modal-open","change-location")}}];return{scope:!1,restrict:"A",bindToController:!0,controller:e,link:function(e,o,s){function w(){var n=window.innerHeight,t=g.get(0).getBoundingClientRect().top,r=g.get(0).getBoundingClientRect().bottom,i=g.height();return{navbarViewportTop:t,navbarScrollTop:t+p.scrollTop(),navbarHeight:i,dropdownHeight:n-i,totalHeight:n}}function rt(n){it.css("border-top-width",n?"1px":"0")}function k(n,t){it.css("height",n?t.dropdownHeight:"")}function ut(n,t){d.animate({height:n.totalHeight},{duration:f,easing:"easeInOutExpo",complete:function(){t&&t()}})}function ft(n,t){d.animate({height:n.navbarHeight},{duration:f,easing:"easeInOutExpo",complete:function(){t&&t()}})}function et(n){$("body").animate({scrollTop:n},500)}function nt(n){n.preventDefault()}function ot(n){if(n){p.css("overflow","hidden");$(document).on("touchmove",nt)}else p.css("overflow",""),$(document).off("touchmove",nt)}function tt(n,t){d.css("height",n?t.totalHeight:t.navbarHeight)}function y(n){var i=b.phase!==n.phase,t=JSON.stringify(b.metrics)!==JSON.stringify(n.metrics);(i||t&&n.phase===l.FULLY_OPENED||t&&n.phase===l.FULLY_CLOSED)&&(n.phase===l.FULLY_CLOSED&&(k(!1,n.metrics),tt(!1,n.metrics)),n.phase===l.ANIMATING_OPEN&&(et(w().navbarScrollTop),k(!0,n.metrics),ut(n.metrics,function(){a(h.OPEN_IMMEDIATELY)})),n.phase===l.FULLY_OPENED&&(p.scrollTop(w().navbarScrollTop),k(!0,n.metrics),tt(!0,n.metrics)),n.phase===l.ANIMATING_CLOSED&&ft(n.metrics,function(){a(h.CLOSE_IMMEDIATELY)}),e.isDropdownActive=n.phase===l.ANIMATING_OPEN||n.phase===l.FULLY_OPENED);n.bodyScrollingFrozen!==b.bodyScrollingFrozen&&(n.bodyScrollingFrozen&&a(h.STORE_FROZEN_SCROLL_TOP),ot(n.bodyScrollingFrozen,n.frozenScrollTop));rt(n.phase!==l.FULLY_CLOSED);b=$.extend(!0,{},n);e.$broadcast("secondary-nav-repaint")}function a(n){var t=[h.REFRESH_SIZE,h.ANIMATE_TO_OPEN,h.OPEN_IMMEDIATELY,h.ANIMATE_TO_CLOSED,h.CLOSE_IMMEDIATELY];t.indexOf(n)!==-1&&(c.metrics=w());n===h.STORE_FROZEN_SCROLL_TOP&&(c.frozenScrollTop=p.scrollTop());n===h.REFRESH_SIZE&&y(c);n===h.TOGGLE&&(c.phase===l.FULLY_CLOSED?a(h.ANIMATE_TO_OPEN):c.phase===l.FULLY_OPENED&&a(h.ANIMATE_TO_CLOSED));n===h.ANIMATE_TO_OPEN&&c.phase!==l.ANIMATING_OPEN&&c.phase!==l.ANIMATING_CLOSED&&(c.bodyScrollingFrozen=!0,c.phase=l.ANIMATING_OPEN,y(c));n===h.OPEN_IMMEDIATELY&&(c.bodyScrollingFrozen=!0,c.phase=l.FULLY_OPENED,y(c));n===h.ANIMATE_TO_CLOSED&&c.phase!==l.ANIMATING_OPEN&&c.phase!==l.ANIMATING_CLOSED&&(c.bodyScrollingFrozen=!0,c.phase=l.ANIMATING_CLOSED,y(c));n===h.CLOSE_IMMEDIATELY&&(c.bodyScrollingFrozen=!1,c.phase=l.FULLY_CLOSED,y(c))}function st(){return $(v).hasClass("in")}function ht(){$(v).collapse&&$(v).collapse("hide")}function ct(n){$(v).on("hidden.bs.collapse",function(){a(n);$(v).off("hidden.bs.collapse")})}function lt(){ct(h.TOGGLE);ht()}function at(){$(v).on("shown.bs.collapse",function(){a(h.CLOSE_IMMEDIATELY)})}var v="#toyota-main-navigation";e.suburb=t.get().suburb;e.attrs=s;e.$on("GeoPostCode",function(n,t,i){e.suburb=i});var p=$("body"),d=o,g=o.find(".js-ty-secondary-nav-wrapper"),it=o.find(".js-ty-secondary-nav-dropdown"),vt=o.find(".js-ty-secondary-nav-icon"),yt=o.data("tyStickToTop"),l={ANIMATING_OPEN:"animatingOpen",FULLY_OPENED:"open",ANIMATING_CLOSED:"animatingClosed",FULLY_CLOSED:"closed"},c={phase:l.FULLY_CLOSED,bodyScrollingFrozen:null,metrics:null,frozenScrollTop:null},b={phase:null,bodyScrollingFrozen:null,metrics:null,frozenScrollTop:null},h={REFRESH_SIZE:"refreshSize",STORE_FROZEN_SCROLL_TOP:"storeFrozenScrollTop",TOGGLE:"toggle",ANIMATE_TO_OPEN:"animateToOpen",OPEN_IMMEDIATELY:"openImmediately",ANIMATE_TO_CLOSED:"animateToClosed",CLOSE_IMMEDIATELY:"closeImmediately"};r.registerInfo(ToyotaConsts.InfoKeys.SecondaryNavMetrics,w());at();e.showHideMenu=function(){if(st()){lt();return}a(h.TOGGLE)};e.closeMenuImmediately=function(){a(h.CLOSE_IMMEDIATELY)};$(n).on("resize",function(){a(h.REFRESH_SIZE)});e.$on("modal-closed",function(){u(function(){a(h.REFRESH_SIZE)},0)});i({$el:o,pseudoEl:"before",breakpointRegexes:{mobile:"^mobile$",desktop:"^desktop$"}}).on("didInitOrChange",function(n,t){t.viewportWidth.is.desktop?a(h.CLOSE_IMMEDIATELY):a(h.REFRESH_SIZE)})}}}]);angular.module("Toyota").directive("tyVideoPlayer",function(){var n=["$scope","$rootScope","$filter","$attrs","$element",function(n,t,i,r,u){var f=function(){var n=r.tyVideoPlayerHeightPercentage,t,i;u.find(".video-player__padding").css("padding-top",n+"%");u.parents(".ty-modal").length&&(t=u.parents(".ty-modal").find(".ty-modal-panel__head").height(),i="calc( (100vh - "+t+"px) * 100 / "+n+")",u.find(".video-player__outer").css("max-width",i))};n.init=function(){n.showPlayer=!0;f()};n.init();u.parents(".ty-modal-fullscreen").length>0&&(n.$on("modal-open",function(){n.showPlayer=!0}),n.$on("modal-close",function(){n.showPlayer=!1}))}];return{scope:!0,restrict:"A",controller:n,bindToController:!0,link:function(){}}})